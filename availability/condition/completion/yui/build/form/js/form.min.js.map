{"version":3,"file":"form.min.js","sources":["../../../src/form/js/form.js"],"sourcesContent":["/**\n * JavaScript for form editing completion conditions.\n *\n * @module moodle-availability_completion-form\n */\nM.availability_completion = M.availability_completion || {};\n\n/**\n * @class M.availability_completion.form\n * @extends M.core_availability.plugin\n */\nM.availability_completion.form = Y.Object(M.core_availability.plugin);\n\n/**\n * Initialises this plugin.\n *\n * @method initInner\n * @param {Array} cms Array of objects containing cmid => name\n */\nM.availability_completion.form.initInner = function(cms) {\n    this.cms = cms;\n};\n\nM.availability_completion.form.getNode = function(json) {\n    // Create HTML structure.\n    var html = '<span class=\"col-form-label pr-3\"> ' + M.util.get_string('title', 'availability_completion') + '</span>' +\n               ' <span class=\"availability-group form-group\"><label>' +\n            '<span class=\"accesshide\">' + M.util.get_string('label_cm', 'availability_completion') + ' </span>' +\n            '<select class=\"custom-select\" name=\"cm\" title=\"' + M.util.get_string('label_cm', 'availability_completion') + '\">' +\n            '<option value=\"0\">' + M.util.get_string('choosedots', 'moodle') + '</option>';\n    for (var i = 0; i < this.cms.length; i++) {\n        var cm = this.cms[i];\n        // String has already been escaped using format_string.\n        html += '<option value=\"' + cm.id + '\">' + cm.name + '</option>';\n    }\n    html += '</select></label> <label><span class=\"accesshide\">' +\n                M.util.get_string('label_completion', 'availability_completion') +\n            ' </span><select class=\"custom-select\" ' +\n                            'name=\"e\" title=\"' + M.util.get_string('label_completion', 'availability_completion') + '\">' +\n            '<option value=\"1\">' + M.util.get_string('option_complete', 'availability_completion') + '</option>' +\n            '<option value=\"0\">' + M.util.get_string('option_incomplete', 'availability_completion') + '</option>' +\n            '<option value=\"2\">' + M.util.get_string('option_pass', 'availability_completion') + '</option>' +\n            '<option value=\"3\">' + M.util.get_string('option_fail', 'availability_completion') + '</option>' +\n            '</select></label></span>';\n    var node = Y.Node.create('<span class=\"form-inline\">' + html + '</span>');\n\n    // Set initial values.\n    if (json.cm !== undefined &&\n            node.one('select[name=cm] > option[value=' + json.cm + ']')) {\n        node.one('select[name=cm]').set('value', '' + json.cm);\n    }\n    if (json.e !== undefined) {\n        node.one('select[name=e]').set('value', '' + json.e);\n    }\n\n    // Add event handlers (first time only).\n    if (!M.availability_completion.form.addedEvents) {\n        M.availability_completion.form.addedEvents = true;\n        var root = Y.one('.availability-field');\n        root.delegate('change', function() {\n            // Whichever dropdown changed, just update the form.\n            M.core_availability.form.update();\n        }, '.availability_completion select');\n    }\n\n    return node;\n};\n\nM.availability_completion.form.fillValue = function(value, node) {\n    value.cm = parseInt(node.one('select[name=cm]').get('value'), 10);\n    value.e = parseInt(node.one('select[name=e]').get('value'), 10);\n};\n\nM.availability_completion.form.fillErrors = function(errors, node) {\n    var cmid = parseInt(node.one('select[name=cm]').get('value'), 10);\n    if (cmid === 0) {\n        errors.push('availability_completion:error_selectcmid');\n    }\n    var e = parseInt(node.one('select[name=e]').get('value'), 10);\n    if (((e === 2) || (e === 3))) {\n        this.cms.forEach(function(cm) {\n            if (cm.id === cmid) {\n                if (cm.completiongradeitemnumber === null) {\n                    errors.push('availability_completion:error_selectcmidpassfail');\n                }\n            }\n        });\n    }\n};\n"],"names":["M","availability_completion","form","Y","Object","core_availability","plugin","initInner","cms","getNode","json","html","util","get_string","i","this","length","cm","id","name","node","Node","create","undefined","one","set","e","addedEvents","delegate","update","fillValue","value","parseInt","get","fillErrors","errors","cmid","push","forEach","completiongradeitemnumber"],"mappings":"AAKAA,EAAEC,wBAA0BD,EAAEC,yBAA2B,GAMzDD,EAAEC,wBAAwBC,KAAOC,EAAEC,OAAOJ,EAAEK,kBAAkBC,QAQ9DN,EAAEC,wBAAwBC,KAAKK,UAAY,SAASC,UAC3CA,IAAMA,KAGfR,EAAEC,wBAAwBC,KAAKO,QAAU,SAASC,cAE1CC,KAAO,sCAAwCX,EAAEY,KAAKC,WAAW,QAAS,2BAAnE,uFAE2Bb,EAAEY,KAAKC,WAAW,WAAY,2BAFzD,0DAGiDb,EAAEY,KAAKC,WAAW,WAAY,2BAH/E,uBAIoBb,EAAEY,KAAKC,WAAW,aAAc,UAAY,YAClEC,EAAI,EAAGA,EAAIC,KAAKP,IAAIQ,OAAQF,IAAK,KAClCG,GAAKF,KAAKP,IAAIM,GAElBH,MAAQ,kBAAoBM,GAAGC,GAAK,KAAOD,GAAGE,KAAO,YAEzDR,MAAQ,qDACIX,EAAEY,KAAKC,WAAW,mBAAoB,2BAD1C,yDAGqCb,EAAEY,KAAKC,WAAW,mBAAoB,2BAH3E,uBAIuBb,EAAEY,KAAKC,WAAW,kBAAmB,2BAJ5D,8BAKuBb,EAAEY,KAAKC,WAAW,oBAAqB,2BAL9D,8BAMuBb,EAAEY,KAAKC,WAAW,cAAe,2BANxD,8BAOuBb,EAAEY,KAAKC,WAAW,cAAe,2BAPxD,wCASJO,KAAOjB,EAAEkB,KAAKC,OAAO,6BAA+BX,KAAO,iBAG/CY,IAAZb,KAAKO,IACDG,KAAKI,IAAI,kCAAoCd,KAAKO,GAAK,MAC3DG,KAAKI,IAAI,mBAAmBC,IAAI,QAAS,GAAKf,KAAKO,SAExCM,IAAXb,KAAKgB,GACLN,KAAKI,IAAI,kBAAkBC,IAAI,QAAS,GAAKf,KAAKgB,GAIjD1B,EAAEC,wBAAwBC,KAAKyB,eAChC3B,EAAEC,wBAAwBC,KAAKyB,aAAc,EAClCxB,EAAEqB,IAAI,uBACZI,SAAS,UAAU,WAEpB5B,EAAEK,kBAAkBH,KAAK2B,WAC1B,2CAGAT,MAGXpB,EAAEC,wBAAwBC,KAAK4B,UAAY,SAASC,MAAOX,MACvDW,MAAMd,GAAKe,SAASZ,KAAKI,IAAI,mBAAmBS,IAAI,SAAU,IAC9DF,MAAML,EAAIM,SAASZ,KAAKI,IAAI,kBAAkBS,IAAI,SAAU,KAGhEjC,EAAEC,wBAAwBC,KAAKgC,WAAa,SAASC,OAAQf,UACrDgB,KAAOJ,SAASZ,KAAKI,IAAI,mBAAmBS,IAAI,SAAU,IACjD,IAATG,MACAD,OAAOE,KAAK,gDAEZX,EAAIM,SAASZ,KAAKI,IAAI,kBAAkBS,IAAI,SAAU,IAC9C,IAANP,GAAmB,IAANA,QACVlB,IAAI8B,SAAQ,SAASrB,IAClBA,GAAGC,KAAOkB,MAC2B,OAAjCnB,GAAGsB,2BACHJ,OAAOE,KAAK"}