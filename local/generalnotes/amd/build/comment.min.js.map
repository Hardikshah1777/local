{"version":3,"sources":["../src/comment.js"],"names":["define","Y","config","image_url","window","M","util","get_string","CommentHelper","args","scope","client_id","itemid","commentarea","component","courseid","contextid","autostart","view","page","handle","one","notoggle","setStyle","on","e","preventDefault","toggle_textarea","prototype","api","wwwroot","post","ta","value","get","set","setStyles","request","action","params","callback","id","obj","cid","container","result","render","newcomment","Node","create","html","insertBefore","linkText","count","register_pagination","register_delete_buttons","noloading","cfg","sesskey","i","method","complete","o","p","alert","data","JSON","parse","responseText","error","arguments","headers","build_querystring","form","io","wait","list","newcmt","ret","ids","template","htmlid","val","profileurl","replace","fullname","tokens","user","time","deleteStr","Escape","content","avatar","push","load","pagination","img","dodelete","remove_dom","cmt","remove","comments","all","size","resp","commentid","register_actions","action_btn","cancel","each","node","theid","parseid","RegExp","match","Event","purgeElement","require","Templates","Notification","title","getAttribute","renderPix","then","catch","exception","re","commenttoggler","d","getStyle","setAttribute","collapsedimage","document","body","hasClass","focus","t","init","options"],"mappings":"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","sourcesContent":["/* eslint-disable */\ndefine(['core/yui','core/config',],function (Y,config) {\n\n    var image_url = window.M.util.image_url;\n    var get_string = window.M.util.get_string;\n\n    function CommentHelper(args) {\n        var scope = this;\n        this.client_id = args.client_id;\n        this.itemid = args.itemid;\n        this.commentarea = args.commentarea;\n        this.component = args.component;\n        this.courseid = args.courseid;\n        this.contextid = args.contextid;\n        this.autostart = (args.autostart);\n        // expand comments?\n        if (this.autostart) {\n            this.view(args.page);\n        }\n        // load comments\n        var handle = Y.one('#comment-link-'+this.client_id);\n        // hide toggle link\n        if (handle) {\n            if (args.notoggle) {\n                handle.setStyle('display', 'none');\n            }\n            handle.on('click', function(e) {\n                e.preventDefault();\n                this.view(0);\n                return false;\n            }, this);\n            // Also handle space/enter key.\n            handle.on('key', function(e) {\n                e.preventDefault();\n                this.view(0);\n                return false;\n            }, '13,32', this);\n        }\n        scope.toggle_textarea(false);\n    }\n\n    CommentHelper.prototype.api = config.wwwroot + '/local/generalnotes/ajax.php';\n\n    CommentHelper.prototype.post = function() {\n        var ta = Y.one('#dlg-content-'+this.client_id);\n        var scope = this;\n        var value = ta.get('value');\n        if (value && value != get_string('addcomment', 'moodle')) {\n            ta.set('disabled', true);\n            ta.setStyles({\n                'backgroundImage': 'url(' + image_url('i/loading_small', 'core') + ')',\n                'backgroundRepeat': 'no-repeat',\n                'backgroundPosition': 'center center'\n            });\n            var params = {'content': value};\n            this.request({\n                action: 'add',\n                scope: scope,\n                params: params,\n                callback: function(id, obj, args) {\n                    var scope = args.scope;\n                    var cid = scope.client_id;\n                    var ta = Y.one('#dlg-content-'+cid);\n                    ta.set('value', '');\n                    ta.set('disabled', false);\n                    ta.setStyle('backgroundImage', 'none');\n                    scope.toggle_textarea(false);\n                    var container = Y.one('#comment-list-'+cid);\n                    var result = scope.render([obj]);\n                    var newcomment = Y.Node.create(result.html);\n                    container.insertBefore(newcomment,container.one('li'));\n                    var linkText = Y.one('#comment-link-text-' + cid);\n                    if (linkText) {\n                        linkText.set('innerHTML', get_string('commentscount', 'moodle', obj.count));\n                    }\n                    scope.register_pagination();\n                    scope.register_delete_buttons();\n                }\n            }, true);\n        }\n    };\n    CommentHelper.prototype.request = function(args, noloading) {\n        var params = {};\n        var scope = this;\n        if (args['scope']) {\n            scope = args['scope'];\n        }\n        //params['page'] = args.page?args.page:'';\n        // the form element only accept certain file types\n        params['sesskey']   = M.cfg.sesskey;\n        params['action']    = args.action?args.action:'';\n        params['client_id'] = this.client_id;\n        params['contextid'] = this.contextid;\n        if (args['params']) {\n            for (i in args['params']) {\n                params[i] = args['params'][i];\n            }\n        }\n        var cfg = {\n            method: 'POST',\n            on: {\n                complete: function(id,o,p) {\n                    if (!o) {\n                        alert('IO FATAL');\n                        return false;\n                    }\n                    var data = Y.JSON.parse(o.responseText);\n                    if (data.error) {\n                        if (data.error == 'require_login') {\n                            args.callback(id,data,p);\n                            return true;\n                        }\n                        alert(data.error);\n                        return false;\n                    } else {\n                        args.callback(id,data,p);\n                        return true;\n                    }\n                }\n            },\n            arguments: {\n                scope: scope\n            },\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            },\n            data: build_querystring(params)\n        };\n        if (args.form) {\n            cfg.form = args.form;\n        }\n        Y.io(this.api, cfg);\n        if (!noloading) {\n            this.wait();\n        }\n    };\n    CommentHelper.prototype.render = function(list, newcmt) {\n        var ret = {};\n        ret.ids = [];\n        var template = Y.one('#cmt-tmpl');\n        var html = '';\n        for(var i in list) {\n            var htmlid = 'comment-'+list[i].id+'-'+this.client_id;\n            var val = template.get('innerHTML');\n            if (list[i].profileurl) {\n                val = val.replace('___name___', '<a href=\"'+list[i].profileurl+'\">'+list[i].fullname+'</a>');\n            } else {\n                val = val.replace('___name___', list[i].fullname);\n            }\n            if (list[i]['delete']||newcmt) {\n                var tokens = {\n                    user: list[i].fullname,\n                    time: list[i].time\n                };\n                var deleteStr = Y.Escape.html(get_string('deletecommentbyon', 'moodle', tokens));\n                list[i].content = '<div class=\"comment-delete\">' +\n                    '<a href=\"#\" role=\"button\" id =\"comment-delete-' + this.client_id + '-' + list[i].id + '\"' +\n                    '   title=\"' + deleteStr + '\">' +\n                    '<span></span>' +\n                    '</a>' +\n                    '</div>' + list[i].content;\n            }\n            val = val.replace('___time___', list[i].time);\n            val = val.replace('___picture___', list[i].avatar);\n            val = val.replace('___content___', list[i].content);\n            val = '<li id=\"'+htmlid+'\">'+val+'</li>';\n            ret.ids.push(htmlid);\n            html = html + val;\n        }\n        ret.html = html;\n        return ret;\n    };\n    CommentHelper.prototype.load = function(page) {\n        var scope = this;\n        var container = Y.one('#comment-ctrl-'+this.client_id);\n        var params = {\n            'action': 'get',\n            'page': page\n        };\n        this.request({\n            scope: scope,\n            params: params,\n            callback: function(id, ret, args) {\n                var linkText = Y.one('#comment-link-text-' + scope.client_id);\n                if (ret.count && linkText) {\n                    linkText.set('innerHTML', get_string('commentscount', 'moodle', ret.count));\n                }\n                var container = Y.one('#comment-list-'+scope.client_id);\n                var pagination = Y.one('#comment-pagination-'+scope.client_id);\n                if (ret.pagination) {\n                    pagination.set('innerHTML', ret.pagination);\n                } else {\n                    //empty paging bar\n                    pagination.set('innerHTML', '');\n                }\n                if (ret.error == 'require_login') {\n                    var result = {};\n                    result.html = get_string('commentsrequirelogin', 'moodle');\n                } else {\n                    var result = scope.render(ret.list);\n                }\n                container.set('innerHTML', result.html);\n                var img = Y.one('#comment-img-'+scope.client_id);\n                if (img) {\n                    img.set('src', image_url('t/expanded', 'core'));\n                }\n                args.scope.register_pagination();\n                args.scope.register_delete_buttons();\n            }\n        });\n    };\n\n    CommentHelper.prototype.dodelete = function(id) {\n        var scope = this,\n            cid = scope.client_id,\n            params = {'commentid': id};\n        function remove_dom(cmt) {\n            cmt.remove();\n            var linkText = Y.one('#comment-link-text-' + cid),\n                comments = Y.all('#comment-list-' + cid + ' li');\n            if (linkText && comments) {\n                linkText.set('innerHTML', get_string('commentscount', 'moodle', comments.size()));\n            }\n        }\n        this.request({\n            action: 'delete',\n            scope: scope,\n            params: params,\n            callback: function(id, resp, args) {\n                var htmlid= 'comment-'+resp.commentid+'-'+resp.client_id;\n                var cmt = Y.one('#'+htmlid);\n                remove_dom(cmt)\n            }\n        }, true);\n    };\n    CommentHelper.prototype.register_actions = function() {\n        // add new comment\n        var action_btn = Y.one('#comment-action-post-'+this.client_id);\n        if (action_btn) {\n            action_btn.on('click', function(e) {\n                e.preventDefault();\n                this.post();\n                return false;\n            }, this);\n        }\n        // cancel comment box\n        var cancel = Y.one('#comment-action-cancel-'+this.client_id);\n        if (cancel) {\n            cancel.on('click', function(e) {\n                e.preventDefault();\n                this.view(0);\n                return false;\n            }, this);\n        }\n    };\n    CommentHelper.prototype.register_delete_buttons = function() {\n        var scope = this;\n        // page buttons\n        Y.all('div.comment-delete a').each(\n            function(node, id) {\n                var theid = node.get('id');\n                var parseid = new RegExp(\"comment-delete-\"+scope.client_id+\"-(\\\\d+)\", \"i\");\n                var commentid = theid.match(parseid);\n                if (!commentid) {\n                    return;\n                }\n                if (commentid[1]) {\n                    Y.Event.purgeElement('#'+theid, false, 'click');\n                }\n                node.on('click', function(e) {\n                    e.preventDefault();\n                    if (commentid[1]) {\n                        scope.dodelete(commentid[1]);\n                    }\n                });\n                // Also handle space/enter key.\n                node.on('key', function(e) {\n                    e.preventDefault();\n                    if (commentid[1]) {\n                        scope.dodelete(commentid[1]);\n                    }\n                }, '13,32');\n                // 13 and 32 are the keycodes for space and enter.\n\n                require(['core/templates', 'core/notification'], function(Templates, Notification) {\n                    var title = node.getAttribute('title');\n                    Templates.renderPix('t/delete', 'core', title).then(function(html) {\n                        node.set('innerHTML', html);\n                    }).catch(Notification.exception);\n                });\n            }\n        );\n    };\n    CommentHelper.prototype.register_pagination = function() {\n        var scope = this;\n        // page buttons\n        Y.all('#comment-pagination-'+this.client_id+' a').each(\n            function(node, id) {\n                node.on('click', function(e, node) {\n                    e.preventDefault();\n                    var id = node.get('id');\n                    var re = new RegExp(\"comment-page-\"+this.client_id+\"-(\\\\d+)\", \"i\");\n                    var result = id.match(re);\n                    this.load(result[1]);\n                }, scope, node);\n            }\n        );\n    };\n    CommentHelper.prototype.view = function(page) {\n        var commenttoggler = Y.one('#comment-link-' + this.client_id);\n        var container = Y.one('#comment-ctrl-'+this.client_id);\n        var ta = Y.one('#dlg-content-'+this.client_id);\n        var img = Y.one('#comment-img-'+this.client_id);\n        var d = container.getStyle('display');\n        if (d=='none'||d=='') {\n            // show\n            if (!this.autostart) {\n                this.load(page);\n            } else {\n                this.register_delete_buttons();\n                this.register_pagination();\n            }\n            container.setStyle('display', 'block');\n            if (img) {\n                img.set('src', image_url('t/expanded', 'core'));\n            }\n            if (commenttoggler) {\n                commenttoggler.setAttribute('aria-expanded', 'true');\n            }\n        } else {\n            // hide\n            container.setStyle('display', 'none');\n            var collapsedimage = 't/collapsed'; // ltr mode\n            if ( Y.one(document.body).hasClass('dir-rtl') ) {\n                collapsedimage = 't/collapsed_rtl';\n            } else {\n                collapsedimage = 't/collapsed';\n            }\n            if (img) {\n                img.set('src', image_url(collapsedimage, 'core'));\n            }\n            if (ta) {\n                ta.set('value','');\n            }\n            if (commenttoggler) {\n                commenttoggler.setAttribute('aria-expanded', 'false');\n            }\n        }\n        if (ta) {\n            //toggle_textarea.apply(ta, [false]);\n            //// reset textarea size\n            ta.on('focus', function() {\n                this.toggle_textarea(true);\n            }, this);\n            //ta.onkeypress = function() {\n            //if (this.scrollHeight > this.clientHeight && !window.opera)\n            //this.rows += 1;\n            //}\n            ta.on('blur', function() {\n                this.toggle_textarea(false);\n            }, this);\n        }\n        this.register_actions();\n        return false;\n    };\n    CommentHelper.prototype.toggle_textarea = function(focus) {\n        var t = Y.one('#dlg-content-'+this.client_id);\n        if (!t) {\n            return false;\n        }\n        if (focus) {\n            if (t.get('value') == get_string('addcomment', 'moodle')) {\n                t.set('value', '');\n                t.setStyle('color', 'black');\n            }\n        }else{\n            if (t.get('value') == '') {\n                t.set('value', get_string('addcomment', 'moodle'));\n                t.setStyle('color','grey');\n                t.set('rows', 2);\n            }\n        }\n    };\n    CommentHelper.prototype.wait = function() {\n        var container = Y.one('#comment-list-'+this.client_id);\n        container.set('innerHTML', '<div class=\"mdl-align\"><img src=\"'+image_url('i/loading_small', 'core')+'\" /></div>');\n    };\n\n    return {\n        init: function (options) {\n            return new CommentHelper(options);\n        }\n    }\n});\n"],"file":"comment.min.js"}