{"version":3,"file":"coursefilterform.min.js","sources":["../src/coursefilterform.js"],"sourcesContent":["/**\n * @module local_squibit/course_filterform\n */\n\nimport * as DynamicTable from 'core_table/dynamic';\nimport * as Notification from 'core/notification';\n\nvar SELECTORS = {\n    filterform: '#coursefilterform form',\n    table: '#region-main table',\n    save: '#coursefilter',\n    cancel: '#cancelfilter',\n};\n\nexport const initTable = () => {\n    var form = document.querySelector(SELECTORS.filterform);\n    if (!form) {\n        return false;\n    }\n    const submitHandler = e => {\n        const {target: triggerelement, submitter} = e;\n\n        e.preventDefault();\n        var table = DynamicTable.getTableFromId(\"courses\");\n        var filterset = DynamicTable.getFilters(table);\n        for (let name in filterset.filters) {\n            if (name in form.elements || (name+'[]') in form.elements) {\n                filterset.filters[name].values = [];\n            }\n        }\n        let refreshTable = false;\n        [...form.elements].forEach(formelement => {\n            const name = formelement.name.replace('[]', '');\n            if (!(name in filterset.filters)) {\n                return;\n            }\n            if (formelement instanceof HTMLSelectElement) {\n                if (formelement.value === '' || formelement.value === 0) {\n                    return;\n                }\n                [...formelement.selectedOptions]\n                    .map(option => filterset.filters[name].values.push(parseInt(option.value)));\n                if (!refreshTable) {\n                    refreshTable = formelement === triggerelement;\n                }\n            } else if (formelement instanceof HTMLInputElement) {\n                if (formelement.type === 'checkbox' && !formelement.checked) {\n                    return;\n                }\n                if (formelement.value === '') {\n                    return;\n                }\n                if (formelement.name === 'courseid') {\n                    if (isNaN(formelement.value)) {\n                        return;\n                    }\n                    filterset.filters[name].values.push(parseInt(formelement.value));\n                } else {\n                    filterset.filters[name].values.push(formelement.value);\n                }\n                if (!refreshTable) {\n                    refreshTable = formelement === triggerelement && formelement.type === 'text';\n                }\n            }\n        });\n        if (refreshTable || submitter) {\n            DynamicTable.setFilters(table, filterset)\n                .then(tableRoot => tableRoot.setAttribute('data-ajaxloaded', 1))\n                .catch(Notification.exception);\n        }\n        return false;\n    };\n\n    const cancelHandler = e => {\n\n        e.preventDefault();\n        var form = document.querySelector(SELECTORS.filterform);\n        var tableRoot = DynamicTable.getTableFromId(\"courses\");\n        var filterset = DynamicTable.getFilters(tableRoot);\n\n        form.reset();\n\n        [...form.elements].forEach(formelement => {\n            const name = formelement.name.replace('[]', '');\n            if (!(name in filterset.filters)) {\n                return;\n            }\n            if (formelement instanceof HTMLSelectElement) {\n                [...formelement.selectedOptions]\n                    .map(() => filterset.filters[name].values.pop());\n            } else if (formelement instanceof HTMLInputElement) {\n                filterset.filters[name].values.pop();\n            }\n        });\n\n         DynamicTable.setFilters(tableRoot, filterset)\n                .then(tableRoot => tableRoot.setAttribute('data-ajaxloaded', 1))\n                .catch(Notification.exception);\n\n        if (tableRoot) {\n            DynamicTable.refreshTableContent(tableRoot, false);\n        }\n    };\n    form.addEventListener('submit', submitHandler);\n    document.querySelector(SELECTORS.cancel).addEventListener('click', cancelHandler);\n    return true;\n};"],"names":["SELECTORS","form","document","querySelector","addEventListener","e","target","triggerelement","submitter","preventDefault","table","DynamicTable","getTableFromId","filterset","getFilters","name","filters","elements","values","refreshTable","forEach","formelement","replace","HTMLSelectElement","value","selectedOptions","map","option","push","parseInt","HTMLInputElement","type","checked","isNaN","setFilters","then","tableRoot","setAttribute","catch","Notification","exception","reset","pop","refreshTableContent"],"mappings":"8vCAOIA,qBACY,yBADZA,iBAIQ,mCAGa,SACjBC,KAAOC,SAASC,cAAcH,0BAC7BC,YACM,SAsFXA,KAAKG,iBAAiB,UApFAC,UACXC,OAAQC,eAATC,UAAyBA,WAAaH,EAE5CA,EAAEI,qBACEC,MAAQC,aAAaC,eAAe,WACpCC,UAAYF,aAAaG,WAAWJ,WACnC,IAAIK,QAAQF,UAAUG,SACnBD,QAAQd,KAAKgB,UAAaF,KAAK,OAASd,KAAKgB,YAC7CJ,UAAUG,QAAQD,MAAMG,OAAS,QAGrCC,cAAe,YACflB,KAAKgB,UAAUG,SAAQC,oBACjBN,KAAOM,YAAYN,KAAKO,QAAQ,KAAM,OACtCP,QAAQF,UAAUG,WAGpBK,uBAAuBE,kBAAmB,IAChB,KAAtBF,YAAYG,OAAsC,IAAtBH,YAAYG,iBAGxCH,YAAYI,iBACXC,KAAIC,QAAUd,UAAUG,QAAQD,MAAMG,OAAOU,KAAKC,SAASF,OAAOH,UAClEL,eACDA,aAAeE,cAAgBd,qBAEhC,GAAIc,uBAAuBS,iBAAkB,IACvB,aAArBT,YAAYU,OAAwBV,YAAYW,kBAG1B,KAAtBX,YAAYG,gBAGS,aAArBH,YAAYN,KAAqB,IAC7BkB,MAAMZ,YAAYG,cAGtBX,UAAUG,QAAQD,MAAMG,OAAOU,KAAKC,SAASR,YAAYG,aAEzDX,UAAUG,QAAQD,MAAMG,OAAOU,KAAKP,YAAYG,OAE/CL,eACDA,aAAeE,cAAgBd,gBAAuC,SAArBc,YAAYU,WAIrEZ,cAAgBX,YAChBG,aAAauB,WAAWxB,MAAOG,WAC1BsB,MAAKC,WAAaA,UAAUC,aAAa,kBAAmB,KAC5DC,MAAMC,aAAaC,YAErB,KAkCXtC,SAASC,cAAcH,kBAAkBI,iBAAiB,SA/BpCC,IAElBA,EAAEI,qBACER,KAAOC,SAASC,cAAcH,sBAC9BoC,UAAYzB,aAAaC,eAAe,WACxCC,UAAYF,aAAaG,WAAWsB,WAExCnC,KAAKwC,YAEDxC,KAAKgB,UAAUG,SAAQC,oBACjBN,KAAOM,YAAYN,KAAKO,QAAQ,KAAM,IACtCP,QAAQF,UAAUG,UAGpBK,uBAAuBE,sBACnBF,YAAYI,iBACXC,KAAI,IAAMb,UAAUG,QAAQD,MAAMG,OAAOwB,QACvCrB,uBAAuBS,kBAC9BjB,UAAUG,QAAQD,MAAMG,OAAOwB,UAItC/B,aAAauB,WAAWE,UAAWvB,WAC3BsB,MAAKC,WAAaA,UAAUC,aAAa,kBAAmB,KAC5DC,MAAMC,aAAaC,WAExBJ,WACAzB,aAAagC,oBAAoBP,WAAW,OAK7C"}