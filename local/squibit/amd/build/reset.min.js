define("local_squibit/reset",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/str","core/loadingicon","core/log","core_form/modalform","core/toast","core/notification"],(function(_exports,_jquery,_ajax,_modal_factory,_modal_events,Str,_loadingicon,_log,_modalform,_toast,_notification){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.custommodal=_exports.callapi=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str),_log=_interopRequireDefault(_log),_modalform=_interopRequireDefault(_modalform);const SELECTORS_resetbtn='[id="resetbtn"]',cache={},showToolip=(btn,value,isshow)=>(0,Str.get_string)("resetremainingmsg","local_squibit",value).then((str=>{(0,_jquery.default)(btn).tooltip("hide").attr("data-original-title",str).tooltip("show"),!0===isshow&&(0,_jquery.default)(btn).tooltip("hide")}));_exports.init=()=>{var button=document.querySelector(SELECTORS_resetbtn);button.addEventListener("click",(e=>{e.preventDefault(),custommodal(Str.get_string("confirmation","admin"),Str.get_string("confirmationmsg","local_squibit"),Str.get_string("yes","moodle")).then((function(confirmationmodal){confirmationmodal.getRoot().on(_modal_events.default.save,(function(){const modalform=new _modalform.default({formClass:"local_squibit\\form\\authform",modalConfig:{title:Str.get_string("authenticateuser","local_squibit"),buttons:{save:Str.get_string("save","moodle")},large:!1},args:{},returnFocus:button});modalform.addEventListener(modalform.events.FORM_SUBMITTED,(responce=>{if(responce.detail){Str.get_string("authenticatesuccess","local_squibit").then(_toast.add).catch(_notification.defaultException),callapi(button,{action:"delete"})}})),modalform.show()})),confirmationmodal.show()}))}))};const custommodal=(title,body,savebtn)=>_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:title,body:body,buttons:{save:savebtn}});_exports.custommodal=custommodal;const callapi=(button,argsdata,lastloader)=>(0,_loadingicon.addIconToContainer)(button).then((loadingIcon=>(lastloader&&lastloader.remove(),_ajax.default.call([{methodname:"local_squibit_sync_all_reset",args:argsdata}])[0].then((_ref=>{let{result:result,usercount:usercount,coursecount:coursecount}=_ref;if(0===usercount&&0===coursecount&&!result){const btnvalue={usercount:0,coursecount:0};return loadingIcon.remove(),button.classList.remove("disabled"),showToolip(button,btnvalue,!0),location.reload(),!0}if(usercount>0||coursecount>0){cache.usercount!==usercount&&(cache.usercount=usercount),cache.coursecount!==coursecount&&(cache.coursecount=coursecount),button.classList.add("disabled");showToolip(button,{usercount:usercount,coursecount:coursecount},!1),argsdata.action="",setTimeout((()=>callapi(button,argsdata,loadingIcon)),5e3)}else button.classList.remove("disabled");return""===usercount?""!==coursecount&&coursecount:usercount})).catch(_log.default.debug))));_exports.callapi=callapi}));

//# sourceMappingURL=reset.min.js.map