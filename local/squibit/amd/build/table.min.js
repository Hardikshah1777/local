define("local_squibit/table",["exports","jquery","core/ajax","core/loadingicon","core/log","core_table/dynamic","core/str"],(function(_exports,_jquery,_ajax,_loadingicon,_log,DynamicTable,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.tableRegister=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_log=_interopRequireDefault(_log),DynamicTable=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(DynamicTable);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["theme_boost/index"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("theme_boost/index")):Promise.resolve(_systemImportTransformerGlobalIdentifier["theme_boost/index"]);const COMPONENT="local_squibit",SELECTORS_syncuser='[data-action="syncuser"]',SELECTORS_syncalluser='[data-action="syncalluser"]',SELECTORS_synccourse='[data-action="synccourse"]',SELECTORS_syncallcourse='[data-action="syncallcourse"]',ACTIONS=["status","new","default"],cache={},showToolip=component=>{if(!cache.count)return;const type=component.getAttribute("data-type");return(0,_str.get_string)("".concat(type,"remaining"),COMPONENT,cache).then((str=>{(0,_jquery.default)(component).tooltip("hide").attr("data-original-title",str).tooltip("show"),setTimeout((()=>(0,_jquery.default)(component).tooltip("hide")),1e3)}))},updateSyncStatus=function(component){let action=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ACTIONS[2],lastloader=arguments.length>2?arguments[2]:void 0;if(!component)return;const type=component.getAttribute("data-type"),methodname="".concat(COMPONENT,"_sync_all_").concat(type);return(0,_loadingicon.addIconToContainer)(component).then((loadingIcon=>(lastloader&&lastloader.remove(),_ajax.default.call([{methodname:methodname,args:{action:action}}])[0].then((_ref=>{let{pending:pending,count:count}=_ref;var actionvalue=ACTIONS[0];return pending||(loadingIcon.remove(),actionvalue=ACTIONS[2]),!0===cache.islast&&location.reload(),count>0?(cache.count!==count&&(cache.count=count,showToolip(component)),component.setAttribute("disabled","disabled"),1===cache.count&&(cache.islast=!0),setTimeout((()=>updateSyncStatus(component,actionvalue,loadingIcon)),5e3)):component.removeAttribute("disabled"),count})).catch(_log.default.debug))))};_exports.tableRegister=tableUniqId=>{const syncalluser=document.querySelector(SELECTORS_syncalluser);syncalluser&&updateSyncStatus(syncalluser),document.addEventListener("click",(e=>{const syncuser=e.target.closest(SELECTORS_syncuser);syncuser&&(0,_loadingicon.addIconToContainer)(syncuser).then((loadingIcon=>{const userid=syncuser.getAttribute("data-userid");_ajax.default.call([{methodname:"".concat(COMPONENT,"_sync_user"),args:{userid:userid}}])[0].then((response=>{_log.default.debug(response);const tableRoot=DynamicTable.getTableFromId(tableUniqId);DynamicTable.refreshTableContent(tableRoot,!1),loadingIcon.remove()}))}));const syncalluser=e.target.closest(SELECTORS_syncalluser);syncalluser&&(syncalluser.disabled?showToolip(syncalluser):updateSyncStatus(syncalluser,ACTIONS[1]))}));const syncallcourse=document.querySelector(SELECTORS_syncallcourse);syncallcourse&&updateSyncStatus(syncallcourse),document.addEventListener("click",(e=>{const synccourse=e.target.closest(SELECTORS_synccourse);synccourse&&(0,_loadingicon.addIconToContainer)(synccourse).then((loadingIcon=>{const courseid=synccourse.getAttribute("data-courseid");_ajax.default.call([{methodname:"".concat(COMPONENT,"_sync_course"),args:{courseid:courseid}}])[0].then((response=>{_log.default.debug(response);const tableRoot=DynamicTable.getTableFromId(tableUniqId);DynamicTable.refreshTableContent(tableRoot,!1),loadingIcon.remove()}))}));const syncallcourse=e.target.closest(SELECTORS_syncallcourse);syncallcourse&&(syncallcourse.disabled?showToolip(syncallcourse):updateSyncStatus(syncallcourse,ACTIONS[1]))}))}}));

//# sourceMappingURL=table.min.js.map