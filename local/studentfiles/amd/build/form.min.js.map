{"version":3,"sources":["../src/form.js"],"names":["selectors","mailtemplate","mailsubject","mailbody","registerEventListener","document","querySelector","form","closest","JSON","parse","dataset","json","templates","notemplateid","templateObj","stringkeys","changeEvent","createEvent","initEvent","forEach","template","parseInt","id","string","push","subject","message","map","stringkey","key","component","then","strings","indexOf","value","addEventListener","e","selectedtemplate","contains","target","dispatchEvent","catch","Notification","exception"],"mappings":"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","sourcesContent":["import {get_strings as getStrings} from \"core/str\";\nimport Notification from \"core/notification\";\n\nconst selectors = {\n    mailtemplate: '#id_mailtemplate',\n    mailsubject: '#id_mailsubject',\n    mailbody: '#id_mailbody',\n};\n\nconst component = 'local_studentfiles';\n\n// eslint-disable-next-line require-jsdoc\nexport function registerEventListener() {\n    let mailtemplate = document.querySelector(selectors.mailtemplate);\n    let mailsubject = document.querySelector(selectors.mailsubject);\n    let mailbody = document.querySelector(selectors.mailbody);\n    let form = mailbody.closest('form');\n    let {templates, notemplateid} = JSON.parse(mailtemplate.dataset.json);\n    let templateObj = {};\n    let stringkeys = [];\n    let changeEvent = document.createEvent('HTMLEvents');\n    changeEvent.initEvent('change', true, true);\n    templates.forEach(template => {\n        templateObj[parseInt(template.id)] = template;\n        if (template.string) {\n            stringkeys.push(template.subject);\n            stringkeys.push(template.message);\n        }\n    });\n    getStrings(stringkeys.map(stringkey => {\n        return {key: stringkey, component};\n    })).then(function(strings) {\n        for (let id in templateObj) {\n            let template = templateObj[id];\n            if (template.string) {\n                template.subject = strings[stringkeys.indexOf(template.subject)];\n                template.message = strings[stringkeys.indexOf(template.message)];\n            }\n        }\n        if (parseInt(mailtemplate.value) === notemplateid) {\n            templateObj[notemplateid].subject = mailsubject.value;\n            templateObj[notemplateid].message = mailbody.value;\n        }\n        form.addEventListener('change', function(e) {\n            let selectedtemplate = parseInt(mailtemplate.value);\n            if (mailtemplate.contains(e.target)) {\n                mailsubject.value = templateObj[selectedtemplate].subject;\n                mailbody.value = templateObj[selectedtemplate].message;\n                mailsubject.dispatchEvent(changeEvent);\n                mailbody.dispatchEvent(changeEvent);\n                return true;\n            }\n            if (selectedtemplate !== notemplateid) {\n                return false;\n            }\n            if (mailsubject.contains(e.target)) {\n                templateObj[notemplateid].subject = mailsubject.value;\n            }\n            if (mailbody.contains(e.target)) {\n                templateObj[notemplateid].message = mailbody.value;\n            }\n            return true;\n        });\n        return true;\n    }).catch(Notification.exception);\n}\n"],"file":"form.min.js"}
