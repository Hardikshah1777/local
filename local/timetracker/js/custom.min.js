!function($){var timer,idleTime=0,contextparam="&contextid="+M.cfg.contextid,siteroot=M.cfg.wwwroot,pagewrapper=$("#page-wrapper");function isTabActive(){return"visible"===document.visibilityState}function isModalOpen(){return $("#bsModal3").hasClass("in")}function trackActivities(){isTabActive()&&!isModalOpen()&&$.ajax({type:"POST",url:siteroot+"/local/timetracker/track_activities.php",data:"status=proceed"+contextparam,success:function(msg){console.log(msg),"askquestion"!=msg?"proceed"==msg?console.log(msg):("smallbreak"==msg?($("body").append('<div class="modal fade" id="smallbreak"  role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static"> <div class="modal-dialog modal-sm">  <div class="modal-content">     <div class="modal-header"> <h4 class="modal-title" id="mySmallModalLabel" style="margin-top: 20px;margin-left: 50px;">break</h4>   </div>  <div class="modal-body">   <p class="statusMsg">Time to take a 10 minute break. You will be logged out.</p>    </div> </div></div>'),$("#smallbreak").modal("show")):"coursebreak"==msg?($("body").append('<div class="modal fade" id="coursebreak"  role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static"> <div class="modal-dialog modal-sm">  <div class="modal-content">     <div class="modal-header"> <h4 class="modal-title" id="mySmallModalLabel" style="margin-top: 20px;margin-left: 50px;">break</h4>   </div>  <div class="modal-body">   <p class="statusMsg">Working time on a course is 3 hours. You will be logged out.</p>    </div> </div></div>'),$("#coursebreak").modal("show")):"endofday"==msg&&($("body").append('<div class="modal fade" id="endofday"  role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static"> <div class="modal-dialog modal-sm">  <div class="modal-content">     <div class="modal-header"> <h4 class="modal-title" id="mySmallModalLabel" style="margin-top: 20px;margin-left: 50px;">break</h4>   </div>  <div class="modal-body">   <p class="statusMsg">Working time on a course is 3 hours. You will be logged out.</p>    </div> </div></div>'),$("#endofday").modal("show")),console.log("redirect",msg),setInterval((function(){console.log("redirecting"),location.reload(!0)}),6e3)):securityQuestion(1,!0)}})}function timerIncrement(){idleTime+=1,console.log("idleTime "+idleTime),idleTime>14e7&&$.ajax({type:"POST",url:siteroot+"/local/timetracker/track_activities.php",data:"status=logout&page=false"+contextparam,success:function(msg){"idletime"==msg&&($("body").append('<div class="modal fade" id="idletime"  role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static"> <div class="modal-dialog modal-sm">  <div class="modal-content">     <div class="modal-header"> <h4 class="modal-title" id="mySmallModalLabel" style="margin-top: 20px;margin-left: 50px;">break</h4>   </div>  <div class="modal-body">   <p class="statusMsg">You were idle for 15 minutes. You will be logged out.</p>    </div> </div></div>'),$("#idletime").modal("show"),setInterval((function(){location.reload(!0)}),6e3))}})}function securityQuestion(askquestion,force,frommodal){console.log("askquestion "+askquestion);var bsmodal=$("#bsModal3");return force&&!bsmodal.hasClass("in")&&bsmodal.remove(),!!isTabActive()&&(!(!frommodal&&isModalOpen())&&void(!force&&bsmodal.hasClass("modal")||($(window).keydown((function(event){if(13==event.keyCode)return event.preventDefault(),!1})),$.getJSON(siteroot+"/local/timetracker/load_question.php?askquestion="+askquestion+contextparam,(function(data){$.each(data,(function(key,val){time=60,tmp=60,clearInterval(timer),timer=setInterval((function(){var c=tmp--,m=c/60>>0,s=c-60*m+"";1==s&&submitContactForm(0),$("#countdown").html("Time Remaining: "+m+":"+(s.length>1?"":"0")+s),0!=tmp||(tmp=60)}),1e3),pagewrapper.append(' <div class="modal fade" id="bsModal3"  role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static">  <div class="modal-dialog modal-sm">    <div class="modal-content">      <div class="modal-header">  <h4 class="modal-title" id="mySmallModalLabel" style="margin-top: 20px;margin-left: 50px;">Security Check</h4>      </div>      <div class="modal-body">   <p class="statusMsg"></p>   <div id="countdown"></div>               <form id="bsModalForm" role="form">  \t\t\t <div class="form-group">    <label class="control-label col-sm-2" for="email">Question: </label>    <div class="col-sm-10">      <p class="form-control-static">'+val+'</p>                </div>                <div class="form-group"> <input id="questionid" type="hidden" class="form-control" name="questionid" value="'+key+'" > <input id="answer" type="text" class="form-control" name="answer" >                    </div>\t\t\t\t       </div>      <div class="modal-footer">          <button type="button" class="btn btn-primary submitForm" >Submit</button>      </div>    </div>  </div></div>'),$("#bsModal3").modal("show"),console.log("in...")}))})))))}function submitContactForm(auto){var qid=$("#questionid").val(),answer=$("input[name=answer]").val();if(""==answer.trim()&&1==auto)return alert("Please enter answer."),$("#questionid").focus(),!1;clearInterval(timer),$.ajax({type:"POST",url:siteroot+"/local/timetracker/submit_form.php",data:"contactFrmSubmit=1&qid="+qid+"&answer="+answer+contextparam,beforeSend:function(){console.log("submitContactForm..")},success:function(msg){if("logout"!=msg)return"wrong"==msg?($(".statusMsg").html('<span style="color:red;"><b>This is incorrect</b></p>'),setTimeout((function(){$("#page-wrapper #bsModal3").remove(),securityQuestion(1,!1,!0)}),1e3)):($("#bsModal3").modal("toggle").delay(1e3).remove(),$(".modal-backdrop").remove(),$("body").removeClass("modal-open")),!1;$("#countdown").html(""),$(".statusMsg").html('<span style="color:red;"><b>You have exceeded the number of attempts allowed contact the administrator to access your course</b></p>'),setInterval((function(){location.reload(!0)}),3e3)}})}$(document).ready((function(){function submitForm(e){e.preventDefault(),submitContactForm(1)}!document.body.classList.contains("pagelayout-embedded")&&"undefined"!=typeof scormplayerdata&&scormplayerdata.popupoptions.length>0?console.log("skipping for scorm popup"):((window.location.href.indexOf("course")>-1||window.location.href.indexOf("mod")>-1)&&(window.location.href.indexOf("view")>-1||window.location.href.indexOf("scorm/player")>-1)&&setInterval((function(){trackActivities()}),1e4),$(window).on("unload",(function(e){(window.location.href.indexOf("course")>-1||window.location.href.indexOf("mod")>-1)&&window.location.href.indexOf("view")>-1&&trackActivities()})),setInterval(timerIncrement,6e4),$(this).mousemove((function(){idleTime=0})),$(this).keypress((function(){idleTime=0})),window.location.href.indexOf("mod")>-1&&window.location.href.indexOf("view")>-1&&(window.location.href,$.getJSON(siteroot+"/local/timetracker/is_lastactivity.php?"+contextparam,(function(data){var msg=data.status,hours=data.hours,returnurl=data.returnurl;"inprogress"==msg&&($("body").append('<div class="modal fade" id="bsModal1"  role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static"> <div class="modal-dialog modal-sm">  <div class="modal-content">     <div class="modal-header"> <h4 class="modal-title" id="mySmallModalLabel">Please spend 20 hours !!!</h4>   </div>  <div class="modal-body">   <p class="statusMsg">You didn\'t complete the minimum course hours.You only spend '+hours+' hours. Please have a look again <a href="'+returnurl+'">Back</a>  </p>    </div> </div></div>'),$("#bsModal1").modal("show"))}))),(window.location.href.indexOf("course")>-1||window.location.href.indexOf("mod")>-1)&&window.location.href.indexOf("view")>-1&&setInterval((function(){securityQuestion(0)}),2e3),pagewrapper.on("click",".submitForm",submitForm).on("submit","#bsModalForm",submitForm))}))}(jQuery);

//# sourceMappingURL=custom.min.js.map