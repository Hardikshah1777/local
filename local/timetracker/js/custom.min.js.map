{"version":3,"file":"custom.min.js","sources":["custom.js"],"sourcesContent":["(function ($) {\n    var idleTime = 0;\n    var timer;\n\n    var contextparam = '&contextid=' + M.cfg.contextid;\n    var siteroot = M.cfg.wwwroot;\n    var pagewrapper = $('#page-wrapper');\n    function isTabActive() {\n        return document.visibilityState === 'visible';\n    }\n    function isModalOpen() {\n        return $('#bsModal3').hasClass('in');\n    }\n\n    function trackActivities() {\n        if (!isTabActive() || isModalOpen()) {\n            return;\n        }\n        $.ajax({\n            type: 'POST',\n            url: siteroot + '/local/timetracker/track_activities.php',\n            data: 'status=proceed' + contextparam,\n            success: function (msg) {\n                console.log(msg);\n                if (msg == 'askquestion') {\n                    securityQuestion(1, true);\n                    return;\n                }\n                if(msg == 'proceed'){\n                    console.log(msg);\n                } else {\n                    if(msg == 'smallbreak')\n                        smallbreak();\n                    else if(msg == 'coursebreak')\n                        coursebreak();\n                    else if(msg == 'endofday')\n                        endofday();\n                    console.log('redirect', msg);\n                    setInterval(function() {\n                        console.log('redirecting');\n                        location.reload(true);\n                    }, 6000);\n                }\n            }\n        });\n\n    }\n\n    function timerIncrement() {\n\n        idleTime = idleTime + 1;\n        console.log('idleTime ' + idleTime);\n        if (idleTime > 140000000) { // 15 minutes\n            $.ajax({\n                type: 'POST',\n                url: siteroot + '/local/timetracker/track_activities.php',\n                data: 'status=logout&page=false' + contextparam,\n                success: function (msg) {\n                    //console.log(msg);\n                    if (msg == 'idletime') {\n                        idletime();\n                        setInterval(function () {\n                            location.reload(true);\n                        }, 6000);\n\n                    }\n                }\n            });\n        }\n    }\n\n    function idletime() {\n        $(\"body\").append('<div class=\"modal fade\" id=\"idletime\"  role=\"dialog\" aria-labelledby=\"mySmallModalLabel\" aria-hidden=\"true\" data-backdrop=\"static\"> <div class=\"modal-dialog modal-sm\">  <div class=\"modal-content\">     <div class=\"modal-header\"> <h4 class=\"modal-title\" id=\"mySmallModalLabel\" style=\"margin-top: 20px;margin-left: 50px;\">break</h4>   </div>  <div class=\"modal-body\">   <p class=\"statusMsg\">You were idle for 15 minutes. You will be logged out.</p>    </div> </div></div>');\n        $('#idletime').modal('show');\n\n    }\n    function smallbreak() {\n        $(\"body\").append('<div class=\"modal fade\" id=\"smallbreak\"  role=\"dialog\" aria-labelledby=\"mySmallModalLabel\" aria-hidden=\"true\" data-backdrop=\"static\"> <div class=\"modal-dialog modal-sm\">  <div class=\"modal-content\">     <div class=\"modal-header\"> <h4 class=\"modal-title\" id=\"mySmallModalLabel\" style=\"margin-top: 20px;margin-left: 50px;\">break</h4>   </div>  <div class=\"modal-body\">   <p class=\"statusMsg\">Time to take a 10 minute break. You will be logged out.</p>    </div> </div></div>');\n        $('#smallbreak').modal('show');\n\n    }\n    function coursebreak() {\n        $(\"body\").append('<div class=\"modal fade\" id=\"coursebreak\"  role=\"dialog\" aria-labelledby=\"mySmallModalLabel\" aria-hidden=\"true\" data-backdrop=\"static\"> <div class=\"modal-dialog modal-sm\">  <div class=\"modal-content\">     <div class=\"modal-header\"> <h4 class=\"modal-title\" id=\"mySmallModalLabel\" style=\"margin-top: 20px;margin-left: 50px;\">break</h4>   </div>  <div class=\"modal-body\">   <p class=\"statusMsg\">Working time on a course is 3 hours. You will be logged out.</p>    </div> </div></div>');\n        $('#coursebreak').modal('show');\n\n    }\n    function endofday() {\n        $(\"body\").append('<div class=\"modal fade\" id=\"endofday\"  role=\"dialog\" aria-labelledby=\"mySmallModalLabel\" aria-hidden=\"true\" data-backdrop=\"static\"> <div class=\"modal-dialog modal-sm\">  <div class=\"modal-content\">     <div class=\"modal-header\"> <h4 class=\"modal-title\" id=\"mySmallModalLabel\" style=\"margin-top: 20px;margin-left: 50px;\">break</h4>   </div>  <div class=\"modal-body\">   <p class=\"statusMsg\">Working time on a course is 3 hours. You will be logged out.</p>    </div> </div></div>');\n        $('#endofday').modal('show');\n\n    }\n\n    function securityQuestion(askquestion, force, frommodal) {\n        console.log('askquestion ' + askquestion);\n\n        var bsmodal = $('#bsModal3');\n\n        if (force && !bsmodal.hasClass(\"in\")) {\n            bsmodal.remove();\n        }\n\n        if (!isTabActive()) {\n            return false;\n        }\n        if (!frommodal && isModalOpen()) {\n            return false;\n        }\n\n        if (force || !bsmodal.hasClass(\"modal\")) {\n            $(window).keydown(function(event){\n                if(event.keyCode == 13) {\n                    event.preventDefault();\n                    return false;\n                }\n            });\n            $.getJSON(siteroot + \"/local/timetracker/load_question.php?askquestion=\" + askquestion + contextparam, function (data) {\n                $.each(data, function (key, val) {\n\n                    // set countdown timer\n                    time = 1 * 60;\n                    tmp = time;\n                    clearInterval(timer);\n                    timer = setInterval(function () {\n\n                        var c = tmp--;\n                        var m = (c / 60) >> 0;\n                        var s = (c - m * 60) + '';\n\n                        if (s == 1) {\n                            submitContactForm(0);\n                        }\n                        $('#countdown').html('Time Remaining: ' + m + ':' + (s.length > 1 ? '' : '0') + s);\n                        tmp != 0 || (tmp = time);\n\n                    }, 1000);\n\n                    pagewrapper.append(' <div class=\"modal fade\" id=\"bsModal3\"  role=\"dialog\" aria-labelledby=\"mySmallModalLabel\" aria-hidden=\"true\" data-backdrop=\"static\">  <div class=\"modal-dialog modal-sm\">    <div class=\"modal-content\">      <div class=\"modal-header\">  <h4 class=\"modal-title\" id=\"mySmallModalLabel\" style=\"margin-top: 20px;margin-left: 50px;\">Security Check</h4>      </div>      <div class=\"modal-body\">   <p class=\"statusMsg\"></p>   <div id=\"countdown\"></div>               <form id=\"bsModalForm\" role=\"form\">  \t\t\t <div class=\"form-group\">    <label class=\"control-label col-sm-2\" for=\"email\">Question: </label>    <div class=\"col-sm-10\">      <p class=\"form-control-static\">' + val + '</p>                </div>                <div class=\"form-group\"> <input id=\"questionid\" type=\"hidden\" class=\"form-control\" name=\"questionid\" value=\"' + key + '\" > <input id=\"answer\" type=\"text\" class=\"form-control\" name=\"answer\" >                    </div>\t\t\t\t       </div>      <div class=\"modal-footer\">          <button type=\"button\" class=\"btn btn-primary submitForm\" >Submit</button>      </div>    </div>  </div></div>');\n                    $('#bsModal3').modal('show');\n                    console.log('in...');\n                });\n\n            });\n\n        }\n\n    }\n\n    function submitContactForm(auto) {\n\n        var qid = $('#questionid').val();\n        var answer = $('input[name=answer]').val();\n\n        if (answer.trim() == '' && auto == 1) {\n            alert('Please enter answer.');\n            $('#questionid').focus();\n            return false;\n\n        } else {\n            clearInterval(timer);\n            //console.log('contactFrmSubmit=1&qid='+qid+'&answer='+answer+'&page='+page+'&activity='+activity);\n            $.ajax({\n                type: 'POST',\n                url: siteroot + '/local/timetracker/submit_form.php',\n                data: 'contactFrmSubmit=1&qid=' + qid + '&answer=' + answer + contextparam,\n                beforeSend: function () {\n                    console.log('submitContactForm..');\n                },\n                success: function (msg) {\n                    //console.log(msg);\n                    if (msg == 'logout') {\n                        $('#countdown').html('');\n                        $('.statusMsg').html('<span style=\"color:red;\"><b>You have exceeded the number of attempts allowed contact the administrator to access your course</b></p>');\n                        setInterval(function () {\n                            location.reload(true);\n                        }, 3000);\n\n                    } else {\n                        if (msg == 'wrong') {\n                            $('.statusMsg').html('<span style=\"color:red;\"><b>This is incorrect</b></p>');\n\n                            setTimeout(function () {\n                                $(\"#page-wrapper #bsModal3\").remove();\n                                securityQuestion(1, false, true);\n                            }, 1000);\n\n                        } else {\n                            $('#bsModal3').modal('toggle').delay(1000).remove();\n                            $(\".modal-backdrop\").remove();\n                            $(\"body\").removeClass('modal-open');\n                        }\n                        return false;\n                    }\n\n\n                }\n            });\n        }\n\n    }\n\n    function isLastActivity() {\n\n        $.getJSON(siteroot + '/local/timetracker/is_lastactivity.php?' + contextparam, function (data) {\n            var msg = data.status;\n            var hours = data.hours;\n            var returnurl = data.returnurl;\n            if (msg == 'inprogress') {\n\n                $(\"body\").append('<div class=\"modal fade\" id=\"bsModal1\"  role=\"dialog\" aria-labelledby=\"mySmallModalLabel\" aria-hidden=\"true\" data-backdrop=\"static\"> <div class=\"modal-dialog modal-sm\">  <div class=\"modal-content\">     <div class=\"modal-header\"> <h4 class=\"modal-title\" id=\"mySmallModalLabel\">Please spend 20 hours !!!</h4>   </div>  <div class=\"modal-body\">   <p class=\"statusMsg\">You didn\\'t complete the minimum course hours.You only spend ' + hours + ' hours. Please have a look again <a href=\"' + returnurl + '\">Back</a>  </p>    </div> </div></div>');\n                $('#bsModal1').modal('show');\n                /*setInterval(function() {\n                        window.location = returnurl;\n                    }, 6000);*/\n\n            } else {\n                //securityQuestion(1);\n            }\n        });\n\n    }\n\n    $(document).ready(function () {\n        if (!document.body.classList.contains('pagelayout-embedded') &&\n            'undefined' !== typeof scormplayerdata && scormplayerdata.popupoptions.length > 0) {\n            console.log('skipping for scorm popup');\n            return;\n        }\n\n        if ((window.location.href.indexOf(\"course\") > -1) || (window.location.href.indexOf(\"mod\") > -1)) {\n            if ((window.location.href.indexOf(\"view\") > -1) || (window.location.href.indexOf(\"scorm/player\") > -1))\n                setInterval(function () {\n                    trackActivities();\n                }, 10000);\n\n        }\n\n\n        $(window).on(\"unload\", function (e) {\n            if ((window.location.href.indexOf(\"course\") > -1) || (window.location.href.indexOf(\"mod\") > -1)) {\n                if ((window.location.href.indexOf(\"view\") > -1))\n                    trackActivities();\n            }\n        });\n\n        //Increment the idle time counter every minute.-15\n\n        setInterval(timerIncrement, 60000); // 1 minute\n\n        //Zero the idle timer on mouse movement.\n        $(this).mousemove(function () {\n            idleTime = 0;\n        });\n        $(this).keypress(function () {\n            idleTime = 0;\n        });\n\n        if ((window.location.href.indexOf(\"mod\") > -1)) {\n            if ((window.location.href.indexOf(\"view\") > -1)) {\n                isLastActivity(window.location.href);\n            }\n        }\n\n        if ((window.location.href.indexOf(\"course\") > -1) || (window.location.href.indexOf(\"mod\") > -1)) {\n            if ((window.location.href.indexOf(\"view\") > -1)) {\n                setInterval(function () {\n                    securityQuestion(0);\n                }, 2000);\n\n            }\n        }\n\n\n        function submitForm(e) {\n            e.preventDefault();\n            submitContactForm(1);\n        }\n        pagewrapper.on(\"click\", \".submitForm\", submitForm)\n        .on(\"submit\", \"#bsModalForm\", submitForm);\n\n\n    });\n\n}(jQuery));\n\n"],"names":["$","timer","idleTime","contextparam","M","cfg","contextid","siteroot","wwwroot","pagewrapper","isTabActive","document","visibilityState","isModalOpen","hasClass","trackActivities","ajax","type","url","data","success","msg","console","log","append","modal","setInterval","location","reload","securityQuestion","timerIncrement","askquestion","force","frommodal","bsmodal","remove","window","keydown","event","keyCode","preventDefault","getJSON","each","key","val","time","tmp","clearInterval","c","m","s","submitContactForm","html","length","auto","qid","answer","trim","alert","focus","beforeSend","setTimeout","delay","removeClass","ready","submitForm","e","body","classList","contains","scormplayerdata","popupoptions","href","indexOf","on","this","mousemove","keypress","status","hours","returnurl","jQuery"],"mappings":"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"}