{"version":3,"sources":["../src/status38.js"],"names":["define","$","Str","ModalFactory","ModalEvents","Templates","Notification","config","Y","Ajax","SELECTORS","BULKACTIONSELECT","BULKUSERCHECKBOXES","BULKUSERNOSCHECKBOXES","BULKUSERSELECTEDCHECKBOXES","BULKACTIONFORM","CHECKALLBUTTON","CHECKALLNOSBUTTON","STATUSCHANGER","mailtemplate","mailbody","endpoint","wwwroot","Participants","options","courseId","courseid","statuses","templates","notemplateid","parseInt","userindex","noteStateNames","stateHelpIcon","attachEventListeners","prototype","bulkSelect","on","e","action","target","val","indexOf","preventDefault","ids","each","index","ele","name","attr","id","replace","push","showSendMessage","fail","exception","showAddNote","prop","length","submit","bind","loader","window","M","util","add_lightbox","Node","document","querySelector","params","sesskey","userids","ref","get_strings","key","component","then","strings","label","insertAfter","selectbox","append","value","idrows","parents","show","post","done","response","success","users","find","replaceWith","hide","status","setTimeout","Deferred","resolve","promise","titlePromise","get_string","when","create","type","types","SAVE_CANCEL","body","render","modal","title","setTitle","setSaveButtonText","getRoot","hidden","focus","remove","save","submitSendMessage","templateObj","forEach","template","message","selectedtemplate","contains","messageText","messages","i","touserid","text","call","methodname","args","messageIds","msg","addNotification","catch","states","selected","context","stateNames","notification","submitAddNote","noteText","publishState","notes","userid","publishstate","noteIds"],"mappings":"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","sourcesContent":["/**\n * Some UI stuff for participants page.\n * This is also used by the report/participants/index.php because it has the same functionality.\n *\n * @module     local_userstatus/status38\n * @package    local_userstatus\n */\n// eslint-disable-next-line max-len\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/templates', 'core/notification', 'core/config', 'core/yui', 'core/ajax'],\n    function($, Str, ModalFactory, ModalEvents, Templates, Notification, config, Y, Ajax) {\n\n        var SELECTORS = {\n            BULKACTIONSELECT: \"#formactioncustom\",\n            BULKUSERCHECKBOXES: \"input.usercheckbox\",\n            BULKUSERNOSCHECKBOXES: \"input.usercheckbox[value='0']\",\n            BULKUSERSELECTEDCHECKBOXES: \"input.usercheckbox:checked\",\n            BULKACTIONFORM: \"#participantsform\",\n            CHECKALLBUTTON: \"#checkall\",\n            CHECKALLNOSBUTTON: \"#checkallnos\",\n            STATUSCHANGER: \"#statuschanger\",\n            mailtemplate: '#id_mailtemplate',\n            mailbody: '#id_mailbody',\n        };\n\n        var endpoint = config.wwwroot + '/local/userstatus/ajax.php';\n        var component = 'local_userstatus';\n\n        /**\n         * Constructor\n         *\n         * @param {Object} options Object containing options. Contextid is required.\n         * Each call to templates.render gets it's own instance of this class.\n         */\n        var Participants = function(options) {\n\n            this.courseId = options.courseid;\n            this.statuses = options.statuses;\n            this.templates = options.templates;\n            this.notemplateid = parseInt(options.notemplateid);\n            this.userindex = options.userindex || false;\n            this.noteStateNames = options.noteStateNames;\n            this.stateHelpIcon = options.stateHelpIcon;\n\n            this.attachEventListeners();\n        };\n        // Class variables and functions.\n\n        /**\n         * @var {int} courseId\n         * @private\n         */\n        Participants.prototype.courseId = -1;\n\n        /**\n         * Private method\n         *\n         * @method attachEventListeners\n         * @private\n         */\n        Participants.prototype.attachEventListeners = function() {\n            var bulkSelect = $(SELECTORS.BULKACTIONSELECT);\n            $(SELECTORS.BULKACTIONSELECT).on('change', function(e) {\n                var action = $(e.target).val();\n                if (action.indexOf('#') !== -1) {\n                    e.preventDefault();\n\n                    var ids = [];\n                    $(SELECTORS.BULKUSERSELECTEDCHECKBOXES).each(function(index, ele) {\n                        var name = $(ele).attr('name');\n                        var id = name.replace('user', '');\n                        ids.push(id);\n                    });\n\n                    if (action == '#messageselect') {\n                        this.showSendMessage(ids).fail(Notification.exception);\n                    } else if (action == '#addgroupnote') {\n                        this.showAddNote(ids).fail(Notification.exception);\n                    }\n                    $(SELECTORS.BULKACTIONSELECT + ' option[value=\"\"]').prop('selected', 'selected');\n                } else if (action !== '') {\n                    if ($(SELECTORS.BULKUSERSELECTEDCHECKBOXES).length > 0) {\n                        $(SELECTORS.BULKACTIONFORM).submit();\n                    } else {\n                        $(SELECTORS.BULKACTIONSELECT + ' option[value=\"\"]').prop('selected', 'selected');\n                    }\n                }\n            }.bind(this));\n            if (bulkSelect.length > 0) {\n                $(SELECTORS.BULKACTIONFORM).attr('data-enhanced', true);\n                var loader = window.M.util.add_lightbox(Y, Y.Node(document.querySelector(SELECTORS.BULKACTIONFORM)));\n                var params = {\n                    sesskey: config.sesskey,\n                    id: this.courseId,\n                    userids: [],\n                    action: 'get',\n                };\n                var ref = this;\n                Str.get_strings([\n                    {\n                        key: 'changestatus',\n                        component: component,\n                    }, {\n                        key: 'choose',\n                    },\n                ]).then(function(strings) {\n                    var label = $('<label for=\"statuschanger\" class=\"col-form-label d-inline ml-2\">' + strings[0] + '</label>');\n                    label.insertAfter($(SELECTORS.BULKACTIONSELECT));\n                    var selectbox = $('<select id=\"statuschanger\" class=\"custom-select mr-2\" disabled></select>');\n                    selectbox.append('<option value=\"\">' + strings[1] + '</option>');\n                    $.each(this.statuses, function(key, value) {\n                        selectbox.append('<option value=\"' + key + '\">' + value + '</option>');\n                    });\n                    selectbox.insertAfter(label);\n                    var idrows = {};\n                    $(SELECTORS.BULKUSERCHECKBOXES).each(function(index, ele) {\n                        var id = ele.name.replace('user', '');\n                        params.userids.push(id);\n                        idrows[id] = $(ele).parents('tr');\n                    }).on('change', function() {\n                        selectbox.prop('disabled', $(SELECTORS.BULKUSERSELECTEDCHECKBOXES).length === 0);\n                    });\n                    if (params.userids.length > 0) {\n                        loader.show();\n                        $.post(endpoint, params).done(function(response) {\n                            if (response.success && response.users) {\n                                $.each(response.users, function(key, value) {\n                                    if (ref.userindex) {\n                                        idrows[key].find('.c1').append(value);\n                                    } else {\n                                        idrows[key].find('[data-statusid]').replaceWith(value);\n                                    }\n                                });\n                            }\n                            params.action = 'put';\n                            params.userids = [];\n                            loader.hide();\n                        });\n                    }\n                    selectbox.on('change', function(e) {\n                        params.status = $(e.target).val();\n                        params.userids = [];\n                        $(SELECTORS.BULKUSERSELECTEDCHECKBOXES).each(function(index, ele) {\n                            var id = ele.name.replace('user', '');\n                            params.userids.push(id);\n                        });\n                        if (params.userids.length === 0 || params.status === '') {\n                            return;\n                        }\n                        selectbox.prop('disabled', true);\n                        loader.show();\n                        $.post(endpoint, params).done(function(response) {\n                            if (response.success && response.users) {\n                                $.each(response.users, function(key, value) {\n                                    idrows[key].find('[data-statusid]').replaceWith(value);\n                                });\n                            }\n                            selectbox.val('').prop('disabled', false);\n                            setTimeout(() => {\n                                loader.hide();\n                            }, 500);\n                        });\n                    });\n                }.bind(this)).fail(Notification.exception);\n            }\n        };\n\n        Participants.prototype.showSendMessage = function(users) {\n\n            if (users.length == 0) {\n                // Nothing to do.\n                return $.Deferred().resolve().promise();\n            }\n            var titlePromise = null;\n            if (users.length == 1) {\n                titlePromise = Str.get_string('sendbulkmessagesingle', 'core_message');\n            } else {\n                titlePromise = Str.get_string('sendbulkmessage', 'core_message', users.length);\n            }\n\n            return $.when(\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: Templates.render('local_userstatus/send_bulk_message',\n                        {\n                            templates: this.templates,\n                            notemplateid: this.notemplateid,\n                        })\n                }),\n                titlePromise\n            ).then(function(modal, title) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n\n                this.modal.setTitle(title);\n                this.modal.setSaveButtonText(title);\n\n                // We want to focus on the action select when the dialog is closed.\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    $(SELECTORS.BULKACTIONSELECT).focus();\n                    this.modal.getRoot().remove();\n                }.bind(this));\n\n                this.modal.getRoot().on(ModalEvents.save, this.submitSendMessage.bind(this, users));\n\n                this.modal.show();\n\n                var templateObj = {};\n                this.templates.forEach(template => {\n                    templateObj[parseInt(template.id)] = template;\n                });\n                templateObj[this.notemplateid] = {message: ''};\n\n                this.modal.getRoot().on('change', function (e) {\n                    var mailtemplate = document.querySelector(SELECTORS.mailtemplate);\n                    var mailbody = document.querySelector(SELECTORS.mailbody);\n                    var selectedtemplate = parseInt(mailtemplate.value);\n                    if (mailtemplate.contains(e.target)) {\n                        mailbody.value = templateObj[selectedtemplate].message;\n                        return true;\n                    }\n                    if (selectedtemplate !== this.notemplateid) {\n                        return false;\n                    }\n                    if (mailbody.contains(e.target)) {\n                        templateObj[this.notemplateid].message = mailbody.value;\n                    }\n                }.bind(this));\n\n                return this.modal;\n            }.bind(this));\n        };\n\n        Participants.prototype.submitSendMessage = function(users) {\n\n            var messageText = this.modal.getRoot().find('form textarea').val();\n\n            var messages = [],\n                i = 0;\n\n            for (i = 0; i < users.length; i++) {\n                messages.push({touserid: users[i], text: messageText});\n            }\n\n            return Ajax.call([{\n                methodname: 'local_userstatus_send_instant_messages',\n                args: {messages: messages}\n            }])[0].then(function(messageIds) {\n                if (messageIds.length == 1) {\n                    return Str.get_string('sendbulkmessagesentsingle', 'core_message');\n                } else {\n                    return Str.get_string('sendbulkmessagesent', 'core_message', messageIds.length);\n                }\n            }).then(function(msg) {\n                Notification.addNotification({\n                    message: msg,\n                    type: \"success\"\n                });\n                return true;\n            }).catch(Notification.exception);\n        };\n\n        Participants.prototype.showAddNote = function(users) {\n\n            if (users.length == 0) {\n                // Nothing to do.\n                return $.Deferred().resolve().promise();\n            }\n\n            var states = [];\n            for (var key in this.noteStateNames) {\n                switch (key) {\n                    case 'draft':\n                        states.push({value: 'personal', label: this.noteStateNames[key]});\n                        break;\n                    case 'public':\n                        states.push({value: 'course', label: this.noteStateNames[key], selected: 1});\n                        break;\n                    case 'site':\n                        states.push({value: key, label: this.noteStateNames[key]});\n                        break;\n                }\n            }\n\n            var context = {stateNames: states, stateHelpIcon: this.stateHelpIcon};\n            var titlePromise = null;\n            if (users.length == 1) {\n                titlePromise = Str.get_string('addbulknotesingle', 'core_notes');\n            } else {\n                titlePromise = Str.get_string('addbulknote', 'core_notes', users.length);\n            }\n\n            return $.when(\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: Templates.render('core_user/add_bulk_note', context)\n                }),\n                titlePromise\n            ).then(function(modal, title) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n                this.modal.setTitle(title);\n                this.modal.setSaveButtonText(title);\n\n                // We want to focus on the action select when the dialog is closed.\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    var notification = $('#user-notifications [role=alert]');\n                    if (notification.length) {\n                        notification.focus();\n                    } else {\n                        $(SELECTORS.BULKACTIONSELECT).focus();\n                    }\n                    this.modal.getRoot().remove();\n                }.bind(this));\n\n                this.modal.getRoot().on(ModalEvents.save, this.submitAddNote.bind(this, users));\n\n                this.modal.show();\n\n                return this.modal;\n            }.bind(this));\n        };\n\n        Participants.prototype.submitAddNote = function(users) {\n            var noteText = this.modal.getRoot().find('form textarea').val();\n            var publishState = this.modal.getRoot().find('form select').val();\n            var notes = [],\n                i = 0;\n\n            for (i = 0; i < users.length; i++) {\n                notes.push({userid: users[i], text: noteText, courseid: this.courseId, publishstate: publishState});\n            }\n\n            return Ajax.call([{\n                methodname: 'core_notes_create_notes',\n                args: {notes: notes}\n            }])[0].then(function(noteIds) {\n                if (noteIds.length == 1) {\n                    return Str.get_string('addbulknotedonesingle', 'core_notes');\n                } else {\n                    return Str.get_string('addbulknotedone', 'core_notes', noteIds.length);\n                }\n            }).then(function(msg) {\n                Notification.addNotification({\n                    message: msg,\n                    type: \"success\"\n                });\n                return true;\n            }).catch(Notification.exception);\n        };\n\n        return {\n            // Public variables and functions.\n\n            /**\n             * Initialise the unified user filter.\n             *\n             * @method init\n             * @param {Object} options - List of options.\n             * @return {Participants}\n             */\n            'init': function(options) {\n                return new Participants(options);\n            }\n        };\n    });\n"],"file":"status38.min.js"}