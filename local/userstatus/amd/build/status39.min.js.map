{"version":3,"sources":["../src/status39.js"],"names":["define","$","Str","ModalFactory","ModalEvents","Templates","Notification","config","DynamicTable","SELECTORS","BULKACTIONSELECT","BULKUSERCHECKBOXES","BULKUSERSELECTEDCHECKBOXES","BULKACTIONFORM","STATUSCHANGER","endpoint","wwwroot","tableForm","uniqueId","Participants","options","courseId","courseid","statuses","selectbox","attachEventListeners","prototype","length","attr","params","sesskey","id","userids","action","get_strings","key","component","then","strings","label","insertAfter","append","each","value","on","e","status","target","val","idrows","index","ele","name","replace","push","parents","post","done","response","success","users","find","replaceWith","bind","prop","refreshTable","dynamictable","obj","uniqueid","document","querySelector","addEventListener","Events","tableContentRefreshed"],"mappings":"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","sourcesContent":["/**\n * Some UI stuff for participants page.\n * This is also used by the report/participants/index.php because it has the same functionality.\n *\n * @module     local_userstatus/status38\n * @package    local_userstatus\n */\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/templates', 'core/notification', 'core/config',\n'core_table/dynamic'], function($, Str, ModalFactory, ModalEvents, Templates, Notification, config, DynamicTable) {\n\n        var SELECTORS = {\n            BULKACTIONSELECT: \"#formactionid\",\n            BULKUSERCHECKBOXES: \"input[data-togglegroup='participants-table'][data-toggle='slave']\",\n            BULKUSERSELECTEDCHECKBOXES: \"input[data-togglegroup='participants-table'][data-toggle='slave']:checked\",\n            BULKACTIONFORM: \"#participantsform\",\n            STATUSCHANGER: \"#statuschanger\",\n        };\n\n        var endpoint = config.wwwroot + '/local/userstatus/ajax.php';\n        var component = 'local_userstatus';\n\n        let tableForm = uniqueId => `form[data-table-unique-id=\"${uniqueId}\"]`;\n\n        /**\n         * Constructor\n         *\n         * @param {Object} options Object containing options. Contextid is required.\n         * Each call to templates.render gets it's own instance of this class.\n         */\n        var Participants = function(options) {\n\n            this.courseId = options.courseid;\n\n            this.statuses = options.statuses;\n\n            this.selectbox = null;\n\n            this.attachEventListeners();\n        };\n        // Class variables and functions.\n\n        /**\n         * @var {int} courseId\n         * @private\n         */\n        Participants.prototype.courseId = -1;\n\n        /**\n         * @var null selectbox\n         * @private\n         */\n        Participants.prototype.selectbox = null;\n\n        /**\n         * Private method\n         *\n         * @method attachEventListeners\n         * @private\n         */\n        Participants.prototype.attachEventListeners = function() {\n            if ($(SELECTORS.BULKACTIONSELECT).length > 0) {\n                $(SELECTORS.BULKACTIONFORM).attr('data-enhanced', true);\n                var params = {\n                    sesskey: config.sesskey,\n                    id: this.courseId,\n                    userids: [],\n                    action: 'get',\n                };\n                Str.get_strings([\n                    {\n                        key: 'changestatus',\n                        component: component,\n                    }, {\n                        key: 'choose',\n                    },\n                ]).then(function(strings) {\n                    if (!this.selectbox) {\n                        var label = $('<label for=\"statuschanger\" class=\"col-form-label d-inline ml-2\">' + strings[0] + '</label>');\n                        label.insertAfter($(SELECTORS.BULKACTIONSELECT));\n                        var selectbox = $('<select id=\"statuschanger\" class=\"custom-select\" disabled></select>');\n                        selectbox.append('<option value=\"\">' + strings[1] + '</option>');\n                        $.each(this.statuses, function(key, value) {\n                            selectbox.append('<option value=\"' + key + '\">' + value + '</option>');\n                        });\n                        selectbox.insertAfter(label);\n                        selectbox.on('change', function(e) {\n                            params.status = $(e.target).val();\n                            params.userids = [];\n                            let idrows = {};\n                            $(SELECTORS.BULKUSERSELECTEDCHECKBOXES).each(function(index, ele) {\n                                var id = ele.name.replace('user', '');\n                                params.userids.push(id);\n                                idrows[id] = $(ele).parents('tr');\n                            });\n                            if (params.userids.length === 0 || params.status === '') {\n                                return;\n                            }\n                            $.post(endpoint, params).done(function(response) {\n                                if (response.success && response.users) {\n                                    $.each(response.users, function(key, value) {\n                                        idrows[key].find('[data-statusid]').replaceWith(value);\n                                    });\n                                }\n                                this.selectbox.val('');\n                            }.bind(this));\n                        }.bind(this));\n                        this.selectbox = selectbox;\n                    }\n                    var idrows = {};\n                    $(SELECTORS.BULKUSERCHECKBOXES).each(function(index, ele) {\n                        var id = ele.name.replace('user', '');\n                        params.userids.push(id);\n                        idrows[id] = $(ele).parents('tr');\n                    }).on('change', function() {\n                        this.selectbox.prop('disabled', $(SELECTORS.BULKUSERSELECTEDCHECKBOXES).length === 0);\n                    }.bind(this));\n                    if (params.userids.length > 0) {\n                        $.post(endpoint, params).done(function(response) {\n                            if (response.success && response.users) {\n                                $.each(response.users, function(key, value) {\n                                    idrows[key].find('.c1').append(value);\n                                });\n                            }\n                            params.action = 'put';\n                            params.userids = [];\n                        });\n                    }\n                }.bind(this));\n            }\n        };\n\n        Participants.prototype.refreshTable = function() {\n            this.attachEventListeners();\n        };\n\n        return {\n            // Public variables and functions.\n\n            /**\n             * Initialise the unified user filter.\n             *\n             * @method init\n             * @param {Object} options - List of options.\n             * @return {Participants}\n             */\n            'init': function(options) {\n                let dynamictable;\n                let obj;\n                if (options.uniqueid) {\n                    dynamictable = document.querySelector(tableForm(options.uniqueid));\n                    SELECTORS.BULKACTIONFORM = dynamictable;\n                }\n                obj = new Participants(options);\n                if (dynamictable) {\n                    dynamictable.addEventListener(DynamicTable.Events.tableContentRefreshed, function() {\n                        obj.refreshTable();\n                    });\n                }\n                return obj;\n            }\n        };\n    });\n"],"file":"status39.min.js"}