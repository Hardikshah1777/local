{"version":3,"file":"session_filterform.min.js","sources":["../src/session_filterform.js"],"sourcesContent":["/**\n * @module report_behaviour/behaviour_sessions_filterform\n */\n\nimport * as DynamicTable from 'core_table/dynamic';\nimport * as Notification from 'core/notification';\n\nvar SELECTORS = {\n    filterform: '#behaviour_filterform form',\n    table: '#region-main table',\n    save: '#savefilter',\n    cancel: '#cancelfilter',\n    tabid: 'behaviour_session',\n    exportbtn: '#exportbtn',\n};\n\nexport const initTable = () => {\n    var form = document.querySelector(SELECTORS.filterform);\n    if (!form) {\n        return false;\n    }\n    const submitHandler = e => {\n        const {target: triggerelement, submitter} = e;\n\n        e.preventDefault();\n        var table = DynamicTable.getTableFromId(SELECTORS.tabid);\n        var filterset = DynamicTable.getFilters(table);\n        for (let name in filterset.filters) {\n            if (name in form.elements || (name+'[]') in form.elements) {\n                filterset.filters[name].values = [];\n            }\n        }\n\n        let refreshTable = false;\n        [...form.elements].forEach(formelement => {\n            const name = formelement.name.replace('[]', '');\n            if (!(name in filterset.filters)) {\n                return;\n            }\n\n            if (formelement instanceof HTMLSelectElement) {\n                if (formelement.value === '' || formelement.value === 0 || !formelement.value) {\n                    return;\n                }\n\n                setbtnfilter(formelement.name, formelement.value);\n                [...formelement.selectedOptions]\n                    .map(option => filterset.filters[name].values.push(parseInt(option.value)));\n\n                if (!refreshTable) {\n                    refreshTable = formelement === triggerelement;\n                }\n            } else if (formelement instanceof HTMLInputElement) {\n                if (formelement.type === 'checkbox' && !formelement.checked) {\n                    return;\n                }\n                if (formelement.value === '') {\n                    return;\n                }\n\n                setbtnfilter(formelement.name, formelement.value);\n                filterset.filters[name].values.push(formelement.value);\n                if (!refreshTable) {\n                    refreshTable = formelement === triggerelement && formelement.type === 'text';\n                }\n            }\n        });\n        if (refreshTable || submitter) {\n            DynamicTable.setFilters(table, filterset)\n                .then(tableRoot => tableRoot.setAttribute('data-ajaxloaded', 1))\n                .catch(Notification.exception);\n        }\n        return false;\n    };\n\n    const cancelHandler = e => {\n\n        e.preventDefault();\n        var form = document.querySelector(SELECTORS.filterform);\n        var tableRoot = DynamicTable.getTableFromId(SELECTORS.tabid);\n        var filterset = DynamicTable.getFilters(tableRoot);\n\n        form.reset();\n\n        [...form.elements].forEach(formelement => {\n            const name = formelement.name.replace('[]', '');\n            if (!(name in filterset.filters)) {\n                return;\n            }\n            if (formelement instanceof HTMLSelectElement) {\n                [...formelement.selectedOptions]\n                    .map(() => filterset.filters[name].values.pop());\n            } else if (formelement instanceof HTMLInputElement) {\n                filterset.filters[name].values.pop();\n            }\n        });\n\n        DynamicTable.setFilters(tableRoot, filterset)\n            .then(tableRoot => tableRoot.setAttribute('data-ajaxloaded', 1))\n            .catch(Notification.exception);\n\n        if (tableRoot) {\n            DynamicTable.refreshTableContent(tableRoot, false);\n        }\n    };\n\n    form.addEventListener('submit', submitHandler);\n    document.querySelector(SELECTORS.cancel).addEventListener('click', cancelHandler);\n\n    return true;\n};\n\nexport const setbtnfilter = (name, value) => {\n    let btn = document.querySelector(SELECTORS.exportbtn);\n    let url = new URL(btn.href);\n    url.searchParams.delete(name);\n    url.searchParams.set(name, value);\n    btn.href = url;\n};"],"names":["SELECTORS","form","document","querySelector","addEventListener","e","target","triggerelement","submitter","preventDefault","table","DynamicTable","getTableFromId","filterset","getFilters","name","filters","elements","values","refreshTable","forEach","formelement","replace","HTMLSelectElement","value","setbtnfilter","selectedOptions","map","option","push","parseInt","HTMLInputElement","type","checked","setFilters","then","tableRoot","setAttribute","catch","Notification","exception","reset","pop","refreshTableContent","btn","url","URL","href","searchParams","delete","set"],"mappings":"yxCAOIA,qBACY,6BADZA,iBAIQ,gBAJRA,gBAKO,oBALPA,oBAMW,gCAGU,SACjBC,KAAOC,SAASC,cAAcH,0BAC7BC,YACM,SAuFXA,KAAKG,iBAAiB,UArFAC,UACXC,OAAQC,eAATC,UAAyBA,WAAaH,EAE5CA,EAAEI,qBACEC,MAAQC,aAAaC,eAAeZ,iBACpCa,UAAYF,aAAaG,WAAWJ,WACnC,IAAIK,QAAQF,UAAUG,SACnBD,QAAQd,KAAKgB,UAAaF,KAAK,OAASd,KAAKgB,YAC7CJ,UAAUG,QAAQD,MAAMG,OAAS,QAIrCC,cAAe,YACflB,KAAKgB,UAAUG,SAAQC,oBACjBN,KAAOM,YAAYN,KAAKO,QAAQ,KAAM,OACtCP,QAAQF,UAAUG,WAIpBK,uBAAuBE,kBAAmB,IAChB,KAAtBF,YAAYG,OAAsC,IAAtBH,YAAYG,QAAgBH,YAAYG,aAIxEC,aAAaJ,YAAYN,KAAMM,YAAYG,WACvCH,YAAYK,iBACXC,KAAIC,QAAUf,UAAUG,QAAQD,MAAMG,OAAOW,KAAKC,SAASF,OAAOJ,UAElEL,eACDA,aAAeE,cAAgBd,qBAEhC,GAAIc,uBAAuBU,iBAAkB,IACvB,aAArBV,YAAYW,OAAwBX,YAAYY,kBAG1B,KAAtBZ,YAAYG,aAIhBC,aAAaJ,YAAYN,KAAMM,YAAYG,OAC3CX,UAAUG,QAAQD,MAAMG,OAAOW,KAAKR,YAAYG,OAC3CL,eACDA,aAAeE,cAAgBd,gBAAuC,SAArBc,YAAYW,WAIrEb,cAAgBX,YAChBG,aAAauB,WAAWxB,MAAOG,WAC1BsB,MAAKC,WAAaA,UAAUC,aAAa,kBAAmB,KAC5DC,MAAMC,aAAaC,YAErB,KAmCXtC,SAASC,cAAcH,kBAAkBI,iBAAiB,SAhCpCC,IAElBA,EAAEI,qBACER,KAAOC,SAASC,cAAcH,sBAC9BoC,UAAYzB,aAAaC,eAAeZ,iBACxCa,UAAYF,aAAaG,WAAWsB,WAExCnC,KAAKwC,YAEDxC,KAAKgB,UAAUG,SAAQC,oBACjBN,KAAOM,YAAYN,KAAKO,QAAQ,KAAM,IACtCP,QAAQF,UAAUG,UAGpBK,uBAAuBE,sBACnBF,YAAYK,iBACXC,KAAI,IAAMd,UAAUG,QAAQD,MAAMG,OAAOwB,QACvCrB,uBAAuBU,kBAC9BlB,UAAUG,QAAQD,MAAMG,OAAOwB,UAIvC/B,aAAauB,WAAWE,UAAWvB,WAC9BsB,MAAKC,WAAaA,UAAUC,aAAa,kBAAmB,KAC5DC,MAAMC,aAAaC,WAEpBJ,WACAzB,aAAagC,oBAAoBP,WAAW,OAO7C,SAGEX,aAAe,CAACV,KAAMS,aAC3BoB,IAAM1C,SAASC,cAAcH,qBAC7B6C,IAAM,IAAIC,IAAIF,IAAIG,MACtBF,IAAIG,aAAaC,OAAOlC,MACxB8B,IAAIG,aAAaE,IAAInC,KAAMS,OAC3BoB,IAAIG,KAAOF"}