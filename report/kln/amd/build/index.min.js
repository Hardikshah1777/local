define("report_kln/index",["exports","core/ajax","core_form/dynamicform","core_table/dynamic","core/notification","core/fragment"],(function(_exports,_ajax,_dynamicform,DynamicTable,Notification,_fragment){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setFilters=_exports.registerDynamicform=_exports.initTimer=void 0,_ajax=_interopRequireDefault(_ajax),_dynamicform=_interopRequireDefault(_dynamicform),DynamicTable=_interopRequireWildcard(DynamicTable),Notification=_interopRequireWildcard(Notification),_fragment=_interopRequireDefault(_fragment);_exports.initTimer=(userId,courseId,intervalSeconds)=>{const intervalMs=1e3*intervalSeconds;let timerId=null;const updateTime=()=>{var seconds;document.hidden||(seconds=intervalSeconds,_ajax.default.call([{methodname:"report_kln_user_timetrack",args:{userid:parseInt(userId),courseid:parseInt(courseId),timespent:parseInt(seconds)}}]))},startTimer=()=>{timerId||(timerId=setInterval(updateTime,intervalMs))};document.hidden||startTimer(),document.addEventListener("visibilitychange",(()=>{document.hidden?timerId&&(clearInterval(timerId),timerId=null):startTimer()}))};const setFilters=formdata=>{const formwrapper=document.querySelector('[data-region="dynamicform"]');if(formwrapper){var table=DynamicTable.getTableFromId(formwrapper.dataset.tableuniqueid),filterset=DynamicTable.getFilters(table);for(const name of Object.keys(filterset.filters))filterset.filters[name].values=[],void 0!==formdata[name]&&("userid"===name||"courseid"===name?filterset.filters[name].values.push(parseInt(formdata[name])):filterset.filters[name].values.push(formdata[name]));DynamicTable.setFilters(table,filterset).catch(Notification.exception)}};_exports.setFilters=setFilters;_exports.registerDynamicform=()=>{const formContainer=document.querySelector('[data-region="dynamicform"]'),dynamicForm=new _dynamicform.default(formContainer,formContainer.dataset.formClass);dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED,(e=>{e.preventDefault();const response=e.detail;setFilters(response.formdata),dynamicForm.updateForm({...response,js:_fragment.default.processCollectedJavascript(response.js)})})),dynamicForm.addEventListener(dynamicForm.events.CANCEL_BUTTON_PRESSED,(e=>{e.preventDefault()}))}}));

//# sourceMappingURL=index.min.js.map