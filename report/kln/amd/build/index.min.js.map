{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport DynamicForm from 'core_form/dynamicform';\nimport * as DynamicTable from 'core_table/dynamic';\nimport * as Notification from 'core/notification';\nimport Fragment from 'core/fragment';\n\nexport const initTimer = (userId, courseId, intervalSeconds) => {\n    const intervalMs = intervalSeconds * 1000;\n    let timerId = null;\n\n    const sendTime = (seconds) => {\n        return Ajax.call([{\n            methodname: 'report_kln_user_timetrack',\n            args: {\n                userid: parseInt(userId),\n                courseid: parseInt(courseId),\n                timespent: parseInt(seconds),\n            }\n        }]);\n    };\n\n    const updateTime = () => {\n        if (document.hidden) {\n            return;\n        }\n        sendTime(intervalSeconds);\n    };\n\n    const startTimer = () => {\n        if (!timerId) {\n            timerId = setInterval(updateTime, intervalMs);\n        }\n    };\n\n    const stopTimer = () => {\n        if (timerId) {\n            clearInterval(timerId);\n            timerId = null;\n        }\n    };\n\n    if (!document.hidden) {\n        startTimer();\n    }\n\n    document.addEventListener(\"visibilitychange\", () => {\n        if (document.hidden) {\n            stopTimer();\n        } else {\n            startTimer();\n        }\n    });\n};\n\nexport const setFilters = (formdata) => {\n    const formwrapper = document.querySelector('[data-region=\"dynamicform\"]');\n    if (!formwrapper) {\n        return;\n    }\n\n    var table = DynamicTable.getTableFromId(formwrapper.dataset.tableuniqueid);\n    var filterset = DynamicTable.getFilters(table);\n\n    for (const name of Object.keys(filterset.filters)) {\n        filterset.filters[name].values = [];\n        if (formdata[name] !== undefined) {\n            if (name === 'userid' || name === 'courseid') {\n                filterset.filters[name].values.push(parseInt(formdata[name]));\n            } else {\n                filterset.filters[name].values.push(formdata[name]);\n            }\n        }\n    }\n\n    DynamicTable.setFilters(table, filterset).catch(Notification.exception);\n    return;\n};\n\nexport const registerDynamicform = () => {\n    const formContainer = document.querySelector('[data-region=\"dynamicform\"]');\n    const dynamicForm = new DynamicForm(formContainer, formContainer.dataset.formClass);\n\n    dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED, (e) => {\n        e.preventDefault();\n        const response = e.detail;\n\n        setFilters(response.formdata);\n        dynamicForm.updateForm({...response, js: Fragment.processCollectedJavascript(response.js)});\n    });\n    dynamicForm.addEventListener(dynamicForm.events.CANCEL_BUTTON_PRESSED, (e) => {\n        e.preventDefault();\n    });\n};\n"],"names":["userId","courseId","intervalSeconds","intervalMs","timerId","updateTime","seconds","document","hidden","Ajax","call","methodname","args","userid","parseInt","courseid","timespent","startTimer","setInterval","addEventListener","clearInterval","setFilters","formdata","formwrapper","querySelector","table","DynamicTable","getTableFromId","dataset","tableuniqueid","filterset","getFilters","name","Object","keys","filters","values","undefined","push","catch","Notification","exception","formContainer","dynamicForm","DynamicForm","formClass","events","FORM_SUBMITTED","e","preventDefault","response","detail","updateForm","js","Fragment","processCollectedJavascript","CANCEL_BUTTON_PRESSED"],"mappings":"qlDAMyB,CAACA,OAAQC,SAAUC,yBAClCC,WAA+B,IAAlBD,oBACfE,QAAU,WAaRC,WAAa,KAXDC,IAAAA,QAYVC,SAASC,SAZCF,QAeLJ,gBAdFO,cAAKC,KAAK,CAAC,CACdC,WAAY,4BACZC,KAAM,CACFC,OAAQC,SAASd,QACjBe,SAAUD,SAASb,UACnBe,UAAWF,SAASR,eAY1BW,WAAa,KACVb,UACDA,QAAUc,YAAYb,WAAYF,cAWrCI,SAASC,QACVS,aAGJV,SAASY,iBAAiB,oBAAoB,KACtCZ,SAASC,OAXTJ,UACAgB,cAAchB,SACdA,QAAU,MAYVa,uBAKCI,WAAcC,iBACjBC,YAAchB,SAASiB,cAAc,kCACtCD,iBAIDE,MAAQC,aAAaC,eAAeJ,YAAYK,QAAQC,eACxDC,UAAYJ,aAAaK,WAAWN,WAEnC,MAAMO,QAAQC,OAAOC,KAAKJ,UAAUK,SACrCL,UAAUK,QAAQH,MAAMI,OAAS,QACVC,IAAnBf,SAASU,QACI,WAATA,MAA8B,aAATA,KACrBF,UAAUK,QAAQH,MAAMI,OAAOE,KAAKxB,SAASQ,SAASU,QAEtDF,UAAUK,QAAQH,MAAMI,OAAOE,KAAKhB,SAASU,QAKzDN,aAAaL,WAAWI,MAAOK,WAAWS,MAAMC,aAAaC,yEAI9B,WACzBC,cAAgBnC,SAASiB,cAAc,+BACvCmB,YAAc,IAAIC,qBAAYF,cAAeA,cAAcd,QAAQiB,WAEzEF,YAAYxB,iBAAiBwB,YAAYG,OAAOC,gBAAiBC,IAC7DA,EAAEC,uBACIC,SAAWF,EAAEG,OAEnB9B,WAAW6B,SAAS5B,UACpBqB,YAAYS,WAAW,IAAIF,SAAUG,GAAIC,kBAASC,2BAA2BL,SAASG,SAE1FV,YAAYxB,iBAAiBwB,YAAYG,OAAOU,uBAAwBR,IACpEA,EAAEC"}