{"version":3,"file":"abswrapper.min.js","sources":["../src/abswrapper.js"],"sourcesContent":["/* global AjaxBootstrapSelectList */\n/**\n* @module theme_boost/abswrapper\n* @package\n*/\ndefine(['theme_boost/bswrapper', 'theme_boost/ajax-bootstrap-select'], ($) => {\n    $.fn.ajaxSelectPicker.defaults = $.extend($.fn.ajaxSelectPicker.defaults, {\n        preserveSelected: true,\n        preserveSelectedPosition: 'before',\n        emptyRequest: true,\n        clearOnEmpty: false,\n        ignoredKeys: {\n            ...$.fn.ajaxSelectPicker.defaults.ignoredKeys,\n            // eslint-disable-next-line quote-props\n            13: 'enter'\n        },\n        ajax: {\n            type: 'POST',\n            dataType: 'json',\n            processData: false,\n            contentType: 'application/json',\n            async: true,\n            loginrequired: true,\n            url: function() {\n                let url = `${M.cfg.wwwroot}/lib/ajax/`;\n                const {loginrequired} = this.options;\n                const requests = this.options.data;\n                const methodInfo = [];\n                const ajaxRequestData = [];\n                url += `${loginrequired ? `service.php?sesskey=${M.cfg.sesskey}&` : 'service-nologin.php?'}`;\n                if (!requests.length) {\n                    return url;\n                }\n                requests.forEach((request, index) => {\n                    ajaxRequestData.push({\n                        index,\n                        ...request\n                    });\n                    methodInfo.push(request.methodname);\n                });\n                const requestInfo = methodInfo.length <= 5 ? methodInfo.sort().join() : methodInfo.length + '-method-calls';\n                this.options.context = requests;\n                url += `info=${requestInfo}`;\n                this.options.data = JSON.stringify(ajaxRequestData);\n                return url;\n            },\n        },\n        log: M.cfg.developerdebug,\n        langCode: document.documentElement.lang,\n        noajax: false,\n    });\n\n    /**\n     * Retrieve data from the cache.\n     *\n     * @param {string} key\n     *   The identifier name of the data to retrieve.\n     * @param {*} [defaultValue]\n     *   The default value to return if no cache data is available.\n     *\n     * @return {*}\n     *   The cached data or defaultValue.\n     */\n    AjaxBootstrapSelectList.prototype.cacheGet = function(key, defaultValue) {\n        key = this.cacheKey(key);\n        var value = this.cache[key] || defaultValue;\n        if (!value && this.plugin.options.noajax) {\n            const selectedValues = this.selected.map(opt => opt.value);\n            this.cache['@@empty@@'].forEach(opt => {\n                opt.preserved = opt.selected = selectedValues.includes(opt.value);\n            });\n            return this.cache['@@empty@@'].filter(option => option.text.toLowerCase().indexOf(key.toLowerCase()) > -1);\n        }\n        this.plugin.log(this.LOG_DEBUG, 'Retrieving cache:', key, value);\n        return value;\n    };\n\n    /**\n     * Save data to the cache.\n     *\n     * @param {string} key\n     *   The identifier name of the data to store.\n     * @param {*} value\n     *   The value of the data to store.\n     */\n    AjaxBootstrapSelectList.prototype.cacheSet = function(key, value) {\n        key = this.cacheKey(key);\n        this.cache[key] = value;\n        this.plugin.lastcachekey = key;\n        this.plugin.log(this.LOG_DEBUG, 'Saving to cache:', key, value);\n    };\n\n    AjaxBootstrapSelectList.prototype.cacheKey = function(key) {\n        if (!this.plugin.options.noajax && this.plugin.options.cacheKey && $.isFunction(this.plugin.options.cacheKey)) {\n            return this.plugin.options.cacheKey.call(this.plugin, key);\n        }\n        return key;\n    };\n\n    $('[data-absselect=\"1\"]').selectpicker().ajaxSelectPicker();\n    $('[data-bsselect=\"1\"]').selectpicker();\n\n    return $;\n});"],"names":["define","$","fn","ajaxSelectPicker","defaults","extend","preserveSelected","preserveSelectedPosition","emptyRequest","clearOnEmpty","ignoredKeys","ajax","type","dataType","processData","contentType","async","loginrequired","url","M","cfg","wwwroot","this","options","requests","data","methodInfo","ajaxRequestData","sesskey","length","forEach","request","index","push","methodname","requestInfo","sort","join","context","JSON","stringify","log","developerdebug","langCode","document","documentElement","lang","noajax","AjaxBootstrapSelectList","prototype","cacheGet","key","defaultValue","cacheKey","value","cache","plugin","selectedValues","selected","map","opt","preserved","includes","filter","option","text","toLowerCase","indexOf","LOG_DEBUG","cacheSet","lastcachekey","isFunction","call","selectpicker"],"mappings":"AAKAA,gCAAO,CAAC,wBAAyB,sCAAuCC,IACpEA,EAAEC,GAAGC,iBAAiBC,SAAWH,EAAEI,OAAOJ,EAAEC,GAAGC,iBAAiBC,SAAU,CACtEE,kBAAkB,EAClBC,yBAA0B,SAC1BC,cAAc,EACdC,cAAc,EACdC,YAAa,IACNT,EAAEC,GAAGC,iBAAiBC,SAASM,YAElC,GAAI,SAERC,KAAM,CACFC,KAAM,OACNC,SAAU,OACVC,aAAa,EACbC,YAAa,mBACbC,OAAO,EACPC,eAAe,EACfC,IAAK,WACD,IAAIA,IAAM,GAAGC,EAAEC,IAAIC,oBACnB,MAAMJ,cAACA,eAAiBK,KAAKC,QACvBC,SAAWF,KAAKC,QAAQE,KACxBC,WAAa,GACbC,gBAAkB,GAExB,GADAT,KAAO,IAAGD,cAAgB,uBAAuBE,EAAEC,IAAIQ,WAAa,yBAC/DJ,SAASK,OACV,OAAOX,IAEXM,SAASM,SAAQ,CAACC,QAASC,SACvBL,gBAAgBM,KAAK,CACjBD,eACGD,UAEPL,WAAWO,KAAKF,QAAQG,WAAW,IAEvC,MAAMC,YAAcT,WAAWG,QAAU,EAAIH,WAAWU,OAAOC,OAASX,WAAWG,OAAS,gBAI5F,OAHAP,KAAKC,QAAQe,QAAUd,SACvBN,KAAO,QAAQiB,cACfb,KAAKC,QAAQE,KAAOc,KAAKC,UAAUb,iBAC5BT,MAGfuB,IAAKtB,EAAEC,IAAIsB,eACXC,SAAUC,SAASC,gBAAgBC,KACnCC,QAAQ,IAcZC,wBAAwBC,UAAUC,SAAW,SAASC,IAAKC,cACvDD,IAAM7B,KAAK+B,SAASF,KACpB,IAAIG,MAAQhC,KAAKiC,MAAMJ,MAAQC,aAC/B,IAAKE,OAAShC,KAAKkC,OAAOjC,QAAQwB,OAAQ,CACtC,MAAMU,eAAiBnC,KAAKoC,SAASC,KAAIC,KAAOA,IAAIN,QAIpD,OAHAhC,KAAKiC,MAAM,aAAazB,SAAQ8B,MAC5BA,IAAIC,UAAYD,IAAIF,SAAWD,eAAeK,SAASF,IAAIN,MAAM,IAE9DhC,KAAKiC,MAAM,aAAaQ,QAAOC,QAAUA,OAAOC,KAAKC,cAAcC,QAAQhB,IAAIe,gBAAkB,IAG5G,OADA5C,KAAKkC,OAAOf,IAAInB,KAAK8C,UAAW,oBAAqBjB,IAAKG,OACnDA,OAWXN,wBAAwBC,UAAUoB,SAAW,SAASlB,IAAKG,OACvDH,IAAM7B,KAAK+B,SAASF,KACpB7B,KAAKiC,MAAMJ,KAAOG,MAClBhC,KAAKkC,OAAOc,aAAenB,IAC3B7B,KAAKkC,OAAOf,IAAInB,KAAK8C,UAAW,mBAAoBjB,IAAKG,QAG7DN,wBAAwBC,UAAUI,SAAW,SAASF,KAClD,OAAK7B,KAAKkC,OAAOjC,QAAQwB,QAAUzB,KAAKkC,OAAOjC,QAAQ8B,UAAYpD,EAAEsE,WAAWjD,KAAKkC,OAAOjC,QAAQ8B,UACzF/B,KAAKkC,OAAOjC,QAAQ8B,SAASmB,KAAKlD,KAAKkC,OAAQL,KAEnDA,KAGXlD,EAAE,wBAAwBwE,eAAetE,mBACzCF,EAAE,uBAAuBwE,eAElBxE"}